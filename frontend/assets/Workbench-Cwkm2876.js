import{r as x,a as S,o as P,i as _,b as O,c as F,d as s,e as p,t as g,w as i,f as v,F as N,h as V,g as j,j as z}from"./index-8jM1g0LY.js";const B={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"8px 2px 12px"}},U={style:{"font-size":"12px",opacity:"0.78"}},W={class:"en-kpi"},C={class:"en-kpi-card"},H={class:"en-kpi-value"},G={class:"en-kpi-card"},I={class:"en-kpi-value"},J={class:"en-kpi-card"},K={class:"en-kpi-value"},Y={class:"en-kpi-card"},q={class:"en-kpi-value"},Q={style:{display:"flex","align-items":"center","justify-content":"space-between"}},X={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ee={__name:"Workbench",setup(Z){const n=x({totalAssets:0,pendingClaims:0,unhandledRisks:0,enabledTasks:0}),m=x({asset:[],risk:[]}),b=x({labels:[],assetTotals:[],riskTotals:[]}),w=S(),L=S(),T=S();let a,r,d,c;const R=()=>{const t=document.documentElement,e=getComputedStyle(t),l=t.classList.contains("dark"),o=(u,y)=>(e.getPropertyValue(u)||"").trim()||y;return{isDark:l,text:o("--en-text",l?"rgba(255,255,255,0.92)":"rgba(15,23,42,0.92)"),text2:o("--en-text-2",l?"rgba(255,255,255,0.72)":"rgba(15,23,42,0.68)"),border:o("--en-border",l?"rgba(255,255,255,0.12)":"rgba(15,23,42,0.08)"),primary:o("--en-primary","#18c5d9"),primary2:o("--en-primary-2","#2ad0ff")}},A=t=>[t.primary,t.primary2,"#34d399","#f59e0b","#a78bfa","#fb7185","#60a5fa","#22c55e"],E=t=>({textStyle:{color:t.text2,fontFamily:'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "PingFang SC", "Microsoft YaHei", "Noto Sans CJK SC", "Noto Sans SC", sans-serif'},color:A(t),tooltip:{backgroundColor:t.isDark?"rgba(12,18,32,0.92)":"rgba(255,255,255,0.96)",borderColor:t.border,textStyle:{color:t.text}},legend:{textStyle:{color:t.text2,fontSize:12},itemWidth:10,itemHeight:10}}),h=()=>{const t=R(),e=E(t),l=m.asset||[],o=m.risk||[],u=t.primary,y=t.isDark?"#fb7185":"#ef4444",D=t.isDark?"rgba(24,197,217,0.12)":"rgba(24,197,217,0.10)",M=t.isDark?"rgba(251,113,133,0.10)":"rgba(239,68,68,0.10)";a==null||a.setOption({...e,tooltip:{...e.tooltip,trigger:"item"},legend:{...e.legend,bottom:4,left:"center",itemGap:10},series:[{type:"pie",center:["50%","44%"],radius:["38%","66%"],avoidLabelOverlap:!0,labelLayout:{hideOverlap:!0},label:{formatter:`{b}
{d}%`,color:t.text2,fontWeight:800},labelLine:{lineStyle:{color:t.border}},data:l}]},{notMerge:!0}),r==null||r.setOption({...e,tooltip:{...e.tooltip,trigger:"item"},legend:{...e.legend,bottom:4,left:"center",itemGap:10},series:[{type:"pie",center:["50%","44%"],radius:["38%","66%"],avoidLabelOverlap:!0,labelLayout:{hideOverlap:!0},label:{formatter:`{b}
{d}%`,color:t.text2,fontWeight:800},labelLine:{lineStyle:{color:t.border}},data:o}]},{notMerge:!0}),d==null||d.setOption({...e,tooltip:{...e.tooltip,trigger:"axis"},legend:{...e.legend,data:["资产总数","风险总数"]},grid:{left:30,right:20,top:30,bottom:30,containLabel:!0},xAxis:{type:"category",data:b.labels,axisLine:{lineStyle:{color:t.border}},axisLabel:{color:t.text2}},yAxis:{type:"value",axisLine:{lineStyle:{color:t.border}},splitLine:{lineStyle:{color:t.isDark?"rgba(255,255,255,0.08)":"rgba(15,23,42,0.08)"}},axisLabel:{color:t.text2}},series:[{name:"资产总数",type:"line",data:b.assetTotals,smooth:!0,symbol:"circle",symbolSize:6,itemStyle:{color:u},lineStyle:{color:u,width:3},areaStyle:{color:D}},{name:"风险总数",type:"line",data:b.riskTotals,smooth:!0,symbol:"diamond",symbolSize:7,itemStyle:{color:y},lineStyle:{color:y,width:3,type:"dashed"},areaStyle:{color:M}}]},{notMerge:!0})},k=async()=>{const{data:t}=await V.get("/api/workbench/overview"),e=(t==null?void 0:t.data)||{},l=e.kpi||{};n.totalAssets=l.assetTotal||0,n.pendingClaims=l.claimPending||0,n.unhandledRisks=l.riskUnhandled||0,n.enabledTasks=l.enabledTasks||0,m.asset=e.assetTypeDist||[],m.risk=e.riskTypeDist||[];const o=e.trend14||{};b.labels=o.labels||[],b.assetTotals=o.assetTotals||[],b.riskTotals=o.riskUnhandledTotals||[],h()},f=()=>{a==null||a.resize(),r==null||r.resize(),d==null||d.resize()};return P(async()=>{const t=Math.max(1,Math.min(window.devicePixelRatio||1,2));a=_(w.value,null,{renderer:"canvas",devicePixelRatio:t}),r=_(L.value,null,{renderer:"canvas",devicePixelRatio:t}),d=_(T.value,null,{renderer:"canvas",devicePixelRatio:t});const e=()=>{h(),f()};c=new MutationObserver(()=>e()),c.observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),window.addEventListener("resize",f),await k()}),O(()=>{var t;window.removeEventListener("resize",f);try{(t=c==null?void 0:c.disconnect)==null||t.call(c)}catch{}a==null||a.dispose(),r==null||r.dispose(),d==null||d.dispose()}),(t,e)=>{const l=v("el-button"),o=v("el-card"),u=v("el-col"),y=v("el-row");return j(),F(N,null,[s("div",B,[e[0]||(e[0]=s("div",{style:{"font-size":"14px","font-weight":"800"}},"欢迎回来",-1)),s("div",U,"资产 "+g(n.totalAssets)+" · 未处理风险 "+g(n.unhandledRisks),1)]),s("div",W,[s("div",C,[e[1]||(e[1]=s("div",{class:"en-kpi-label"},"资产总数",-1)),s("div",H,g(n.totalAssets),1),e[2]||(e[2]=s("div",{class:"en-kpi-sub"},"当前资产列表中的资产数量",-1))]),s("div",G,[e[3]||(e[3]=s("div",{class:"en-kpi-label"},"待认领资产",-1)),s("div",I,g(n.pendingClaims),1),e[4]||(e[4]=s("div",{class:"en-kpi-sub"},"扫描发现但尚未认领的资产",-1))]),s("div",J,[e[5]||(e[5]=s("div",{class:"en-kpi-label"},"待处理风险",-1)),s("div",K,g(n.unhandledRisks),1),e[6]||(e[6]=s("div",{class:"en-kpi-sub"},"评估命中且状态为未处理",-1))]),s("div",Y,[e[7]||(e[7]=s("div",{class:"en-kpi-label"},"进行中任务",-1)),s("div",q,g(n.enabledTasks),1),e[8]||(e[8]=s("div",{class:"en-kpi-sub"},"数据库调度中启用的任务",-1))])]),e[14]||(e[14]=s("div",{style:{height:"12px"}},null,-1)),p(y,{gutter:12},{default:i(()=>[p(u,{span:12},{default:i(()=>[p(o,null,{header:i(()=>[s("div",Q,[e[10]||(e[10]=s("div",{style:{"font-weight":"700"}},"资产类型分布",-1)),p(l,{size:"small",onClick:k},{default:i(()=>[...e[9]||(e[9]=[z("刷新",-1)])]),_:1})])]),default:i(()=>[s("div",{ref_key:"assetTypeEl",ref:w,style:{height:"320px"}},null,512)]),_:1})]),_:1}),p(u,{span:12},{default:i(()=>[p(o,null,{header:i(()=>[s("div",X,[e[12]||(e[12]=s("div",{style:{"font-weight":"700"}},"风险类型分布（未处理）",-1)),p(l,{size:"small",onClick:k},{default:i(()=>[...e[11]||(e[11]=[z("刷新",-1)])]),_:1})])]),default:i(()=>[s("div",{ref_key:"riskTypeEl",ref:L,style:{height:"320px"}},null,512)]),_:1})]),_:1})]),_:1}),e[15]||(e[15]=s("div",{style:{height:"12px"}},null,-1)),p(o,null,{header:i(()=>[...e[13]||(e[13]=[s("div",{style:{"font-weight":"700"}},"近 14 天趋势",-1)])]),default:i(()=>[s("div",{ref_key:"trendEl",ref:T,style:{height:"300px"}},null,512)]),_:1})],64)}}};export{ee as default};
