import{_ as W,a as T,r as A,k as x,o as Y,c as F,d as e,e as n,l as q,f as c,w as a,F as G,h as w,g as J,j as r,t as C,E as p,x as h}from"./index-BFugLfXi.js";const Q={class:"en-page"},Z={class:"en-toolbar"},ee={class:"en-table-wrap"},le={style:{display:"flex","align-items":"center",gap:"8px"}},te={style:{"min-width":"0",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},ne={style:{display:"flex","justify-content":"flex-end","margin-bottom":"8px"}},se={class:"en-code"},ae={style:{display:"flex","justify-content":"flex-end","margin-bottom":"8px"}},oe={class:"en-code"},de={class:"en-code"},ie={__name:"SystemApiKeys",setup(ue){const K=T([]),y=A({keyword:"",enabled:void 0}),b=T(new Set),U=x(()=>Array.from(b.value).length),i=A({visible:!1,loading:!1,form:{note:"",enabled:0}}),u=A({visible:!1,tab:"samples",curl:"",http:"",response:""}),k=x(()=>{var t;return((t=window.location)==null?void 0:t.origin)||""}),f=async()=>{const{data:t}=await w.get("/api/system/api-keys");K.value=(t==null?void 0:t.data)||[],b.value=new Set},V=x(()=>{const t=String(y.keyword||"").trim().toLowerCase();return K.value.filter(l=>{if((y.enabled===0||y.enabled===1)&&Number(l.enabled??0)!==Number(y.enabled))return!1;if(!t)return!0;const d=String(l.note||"").toLowerCase(),o=String(l.apiKey||"").toLowerCase();return d.includes(t)||o.includes(t)})}),E=t=>{const l=new Set(V.value.map(o=>o.id)),d=new Set(b.value);for(const o of l)d.delete(o);for(const o of t||[])(o==null?void 0:o.id)!=null&&d.add(o.id);b.value=d},N=async t=>{var l,d;if((t==null?void 0:t.id)!=null){try{await h.confirm(`确认删除 API Key ${t.note||t.apiKey}？`,"删除确认",{type:"warning"})}catch{return}try{await w.delete(`/api/system/api-keys/${encodeURIComponent(t.id)}`),p.success("已删除"),b.value.delete(t.id),await f()}catch(o){p.error(((d=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:d.message)||"删除失败")}}},B=async()=>{var l,d;const t=Array.from(b.value);if(t.length!==0){try{await h.confirm(`确认删除选中的 ${t.length} 个 API Key？`,"删除确认",{type:"warning"})}catch{return}try{await w.post("/api/system/api-keys/batch-delete",{ids:t}),p.success("已删除"),b.value=new Set,await f()}catch(o){p.error(((d=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:d.message)||"删除失败")}}},z=()=>{const t=k.value.replace(/^https?:\/\//,"");u.tab="samples",u.curl=`curl -s \\
  -H "X-API-Key: <API_KEY>" \\
  "${k.value}/openapi/assets?assetType=WEB_APP&importance=重要业务&owner=张三&department=安全运营"

# 也可以不带过滤参数（返回全部资产）
curl -s -H "X-API-Key: <API_KEY>" "${k.value}/openapi/assets"`,u.http=`GET /openapi/assets?assetType=WEB_APP&importance=重要业务&owner=张三&department=安全运营 HTTP/1.1
Host: ${t}
X-API-Key: <API_KEY>
Accept: application/json
Connection: close
`,u.response=`{
  "success": true,
  "code": "OK",
  "message": "OK",
  "data": [
    {
      "id": 1,
      "assetCode": "ASSET-20260206-N0IT",
      "assetName": "会议系统",
      "assetType": "WEB_APP",
      "assetAddress": "http://60.208.20.170:7888",
      "importance": "重要业务",
      "assetStatus": "可用",
      "owner": "",
      "department": "",
      "techStack": "",
      "assetDesc": "",
      "geoLocation": "CN/山东/青岛市",
      "createdAt": "2026-02-06 16:39:56",
      "updatedAt": "2026-02-10 16:12:34"
    }
  ]
}
`,u.visible=!0},H=()=>{i.form={note:"外部资产查询",enabled:0},i.visible=!0},_=async t=>{const l=String(t||"");if(l)try{await navigator.clipboard.writeText(l),p.success("已复制")}catch{p.error("复制失败")}},D=async()=>{var t,l;if(!String(i.form.note||"").trim()){p.error("名称不能为空");return}i.loading=!0;try{const{data:d}=await w.post("/api/system/api-keys",{enabled:i.form.enabled,note:i.form.note.trim()}),o=d==null?void 0:d.data;i.visible=!1,o!=null&&o.apiKey&&await _(o.apiKey),p.success("已创建"),await f()}catch(d){p.error(((l=(t=d==null?void 0:d.response)==null?void 0:t.data)==null?void 0:l.message)||"创建失败")}finally{i.loading=!1}},L=async t=>{try{await w.post(`/api/system/api-keys/${encodeURIComponent(t.id)}/enabled`,{enabled:t.enabled}),p.success("已更新")}catch{p.error("更新失败"),await f()}},j=async t=>{try{await w.post(`/api/system/api-keys/${encodeURIComponent(t.id)}/rotate`),p.success("已轮换"),await f()}catch{p.error("轮换失败")}};return Y(f),(t,l)=>{const d=c("el-input"),o=c("el-option"),O=c("el-select"),m=c("el-button"),v=c("el-table-column"),S=c("el-switch"),R=c("el-table"),I=c("el-form-item"),X=c("el-form"),P=c("el-dialog"),$=c("el-tab-pane"),M=c("el-tabs");return J(),F(G,null,[e("div",Q,[e("div",Z,[n(d,{modelValue:y.keyword,"onUpdate:modelValue":l[0]||(l[0]=s=>y.keyword=s),placeholder:"搜索 名称/API Key",clearable:"",style:{width:"260px"},onKeyup:q(f,["enter"])},null,8,["modelValue"]),n(O,{modelValue:y.enabled,"onUpdate:modelValue":l[1]||(l[1]=s=>y.enabled=s),placeholder:"启用状态",clearable:"",style:{width:"140px"}},{default:a(()=>[n(o,{label:"启用",value:1}),n(o,{label:"停用",value:0})]),_:1},8,["modelValue"]),n(m,{onClick:f},{default:a(()=>[...l[11]||(l[11]=[r("刷新",-1)])]),_:1}),l[15]||(l[15]=e("div",{class:"spacer"},null,-1)),n(m,{onClick:z},{default:a(()=>[...l[12]||(l[12]=[r("API 文档",-1)])]),_:1}),n(m,{type:"danger",plain:"",disabled:U.value===0,onClick:B},{default:a(()=>[...l[13]||(l[13]=[r("批量删除",-1)])]),_:1},8,["disabled"]),n(m,{type:"primary",onClick:H},{default:a(()=>[...l[14]||(l[14]=[r("创建 Key",-1)])]),_:1})]),e("div",ee,[n(R,{data:V.value,height:"100%",border:"","row-key":"id","reserve-selection":!0,onSelectionChange:E},{default:a(()=>[n(v,{type:"selection",width:"46"}),n(v,{prop:"note",label:"名称","min-width":"200","show-overflow-tooltip":""}),n(v,{prop:"apiKey",label:"API Key","min-width":"360","show-overflow-tooltip":""},{default:a(({row:s})=>[e("div",le,[e("span",te,C(s.apiKey),1),n(m,{size:"small",text:"",onClick:g=>_(s.apiKey)},{default:a(()=>[...l[16]||(l[16]=[r("复制",-1)])]),_:1},8,["onClick"])])]),_:1}),n(v,{prop:"enabled",label:"启用",width:"90"},{default:a(({row:s})=>[n(S,{modelValue:s.enabled,"onUpdate:modelValue":g=>s.enabled=g,"active-value":1,"inactive-value":0,onChange:g=>L(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),n(v,{prop:"updatedAt",label:"更新时间",width:"170"}),n(v,{label:"操作",width:"200",fixed:"right"},{default:a(({row:s})=>[n(m,{size:"small",onClick:g=>j(s)},{default:a(()=>[...l[17]||(l[17]=[r("轮换",-1)])]),_:1},8,["onClick"]),n(m,{size:"small",type:"danger",plain:"",onClick:g=>N(s)},{default:a(()=>[...l[18]||(l[18]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),n(P,{modelValue:i.visible,"onUpdate:modelValue":l[5]||(l[5]=s=>i.visible=s),title:"创建 API Key",width:"560px"},{footer:a(()=>[n(m,{disabled:i.loading,onClick:l[4]||(l[4]=s=>i.visible=!1)},{default:a(()=>[...l[19]||(l[19]=[r("取消",-1)])]),_:1},8,["disabled"]),n(m,{type:"primary",loading:i.loading,onClick:D},{default:a(()=>[...l[20]||(l[20]=[r("创建",-1)])]),_:1},8,["loading"])]),default:a(()=>[n(X,{model:i.form,"label-width":"90px"},{default:a(()=>[n(I,{label:"名称",required:""},{default:a(()=>[n(d,{modelValue:i.form.note,"onUpdate:modelValue":l[2]||(l[2]=s=>i.form.note=s),placeholder:"例如：外部资产查询（生产）"},null,8,["modelValue"])]),_:1}),n(I,{label:"启用"},{default:a(()=>[n(S,{modelValue:i.form.enabled,"onUpdate:modelValue":l[3]||(l[3]=s=>i.form.enabled=s),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),n(P,{modelValue:u.visible,"onUpdate:modelValue":l[10]||(l[10]=s=>u.visible=s),title:"SOC API接口文档",width:"920px"},{footer:a(()=>[n(m,{onClick:l[9]||(l[9]=s=>u.visible=!1)},{default:a(()=>[...l[28]||(l[28]=[r("关闭",-1)])]),_:1})]),default:a(()=>[n(M,{modelValue:u.tab,"onUpdate:modelValue":l[8]||(l[8]=s=>u.tab=s)},{default:a(()=>[n($,{label:"请求示例",name:"samples"},{default:a(()=>[l[23]||(l[23]=e("div",{class:"en-muted",style:{"font-size":"12px","margin-bottom":"8px"}},[r(" 仅开放查询能力，Header 传入 "),e("span",{class:"en-mono"},"X-API-Key"),r(" 即可访问 ")],-1)),l[24]||(l[24]=e("div",{class:"en-doc-sub"},"curl 方式",-1)),e("div",ne,[n(m,{size:"small",onClick:l[6]||(l[6]=s=>_(u.curl))},{default:a(()=>[...l[21]||(l[21]=[r("复制 curl",-1)])]),_:1})]),e("pre",se,C(u.curl),1),l[25]||(l[25]=e("div",{class:"en-doc-sub"},"Burp 请求包",-1)),e("div",ae,[n(m,{size:"small",onClick:l[7]||(l[7]=s=>_(u.http))},{default:a(()=>[...l[22]||(l[22]=[r("复制 HTTP",-1)])]),_:1})]),e("pre",oe,C(u.http),1),l[26]||(l[26]=e("div",{class:"en-doc-sub"},"响应示例",-1)),e("pre",de,C(u.response),1)]),_:1}),n($,{label:"参数说明",name:"params"},{default:a(()=>[...l[27]||(l[27]=[e("div",{class:"en-doc-title"},"查询参数",-1),e("div",{class:"en-muted",style:{"font-size":"12px","margin-bottom":"10px"}}," 字典字段为精确匹配（状态/资产类型/业务重要性），其余字段为模糊匹配 ",-1),e("table",{class:"en-doc-table"},[e("thead",null,[e("tr",null,[e("th",null,"参数"),e("th",null,"说明"),e("th",null,"匹配方式")])]),e("tbody",null,[e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"status")]),e("td",null,"资产状态（字典）"),e("td",null,"精确")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"assetType")]),e("td",null,"资产类型（字典）"),e("td",null,"精确")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"importance")]),e("td",null,"业务重要性（字典）"),e("td",null,"精确")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"owner")]),e("td",null,"负责人"),e("td",null,"模糊")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"department")]),e("td",null,"部门"),e("td",null,"模糊")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"assetCode")]),e("td",null,"资产编码"),e("td",null,"模糊")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"assetName")]),e("td",null,"资产名称"),e("td",null,"模糊")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"assetAddress")]),e("td",null,"资产地址"),e("td",null,"模糊")])])],-1),e("div",{class:"en-doc-sep"},null,-1),e("div",{class:"en-doc-title"},"响应参数",-1),e("table",{class:"en-doc-table"},[e("thead",null,[e("tr",null,[e("th",null,"字段"),e("th",null,"说明")])]),e("tbody",null,[e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"id")]),e("td",null,"主键 ID")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"assetCode")]),e("td",null,"资产编码")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"assetName")]),e("td",null,"资产名称")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"assetType")]),e("td",null,"资产类型（字典值）")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"assetAddress")]),e("td",null,"资产地址")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"importance")]),e("td",null,"业务重要性（字典值）")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"assetStatus")]),e("td",null,"资产状态（字典值）")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"owner")]),e("td",null,"负责人")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"department")]),e("td",null,"部门")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"techStack")]),e("td",null,"技术栈")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"assetDesc")]),e("td",null,"资产描述")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"geoLocation")]),e("td",null,"地理位置")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"createdAt")]),e("td",null,"创建时间")]),e("tr",null,[e("td",null,[e("span",{class:"en-mono"},"updatedAt")]),e("td",null,"更新时间")])])],-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])],64)}}},pe=W(ie,[["__scopeId","data-v-06e094ef"]]);export{pe as default};
