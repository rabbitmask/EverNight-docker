import{_ as W,a as N,r as J,o as X,c as f,d as n,v as h,e,w as o,f as m,l as $,C as Y,D as Z,p as ee,h as S,g as c,j as a,F as x,t as s,x as q,E}from"./index-BEN9G-LX.js";const te={class:"en-page"},le={class:"en-toolbar"},oe={class:"en-table-wrap"},se={class:"en-footer"},ae={key:0,class:"en-muted",style:{"font-size":"12px","padding-top":"8px"}},ne={key:0,style:{display:"flex","flex-direction":"column",gap:"12px"}},re={class:"en-code",style:{margin:"0","white-space":"pre-wrap"}},ie={class:"en-code",style:{margin:"0","white-space":"pre-wrap"}},de={class:"en-code",style:{margin:"0","white-space":"pre-wrap"}},pe={class:"en-code",style:{margin:"0","white-space":"pre-wrap"}},ue={class:"en-code",style:{margin:"0","white-space":"pre-wrap"}},ce={class:"en-code",style:{margin:"0","white-space":"pre-wrap"}},fe={class:"en-code",style:{margin:"0","white-space":"pre-wrap"}},we={class:"en-code",style:{margin:"0","white-space":"pre-wrap"}},me={class:"en-code",style:{margin:"0","white-space":"pre-wrap"}},_e={class:"en-code",style:{margin:"0","white-space":"pre-wrap"}},be={style:{display:"flex","justify-content":"flex-end","margin-top":"-8px"}},ge={class:"en-code",style:{"max-height":"220px",overflow:"auto"}},ye={style:{display:"flex","justify-content":"flex-end","margin-top":"-8px"}},xe={class:"en-code",style:{"max-height":"220px",overflow:"auto"}},ve={style:{display:"flex","justify-content":"flex-end","margin-top":"-8px"}},he={class:"en-code",style:{"max-height":"220px",overflow:"auto"}},Ce={style:{display:"flex","justify-content":"flex-end","margin-top":"-8px"}},Te={class:"en-code",style:{"max-height":"220px",overflow:"auto"}},ke={key:2,class:"en-muted",style:{"font-size":"12px"}},ze={key:3,style:{display:"flex","justify-content":"flex-end","margin-top":"-8px"}},Ne={key:4,class:"en-code",style:{"max-height":"260px",overflow:"auto"}},Ee={__name:"Logs",setup(Me){const u=N("login"),B=N([]),M=N(0),k=N(!1),b=J({current:1,size:20}),g=J({logCode:"",keyword:""}),l=J({visible:!1,title:"详情",row:null,beforeText:"",afterText:"",contentText:"",responseText:"",detailJsonText:""}),P=p=>{const t=String(p||"").toUpperCase();return t?t.includes("BATCH_DELETE")?"批量删除":t.includes("DELETE")?"删除":t.includes("CREATE")?"新增":t.includes("UPDATE")||t.includes("UPSERT")?"更新":t.includes("SET_ENABLED")||t.includes("ENABLE")||t.includes("DISABLE")?"启停":t.includes("RUN")?"执行":t.includes("CLAIM")?"认领":p||"-":"-"},V=p=>{if(!p)return"";try{return JSON.stringify(JSON.parse(String(p)),null,2)}catch{return String(p)}},U=p=>{l.row=p,l.title=u.value==="login"?"登录日志详情":u.value==="asset"?"操作日志详情":"告警日志详情",l.beforeText="",l.afterText="",l.contentText="",l.responseText="",l.detailJsonText="",u.value==="asset"&&(l.beforeText=V(p.beforeJson)||"-",l.afterText=V(p.afterJson)||"-"),u.value==="alarm"&&(l.contentText=String(p.content||"-"),l.responseText=String(p.responseText||"-")),l.detailJsonText=V(p.detailJson),l.visible=!0},C=async p=>{try{await navigator.clipboard.writeText(String(p||"")),E.success("已复制")}catch{E.error("复制失败")}},D=p=>{b.size=p,b.current=1,y()},L=()=>{y()},y=async(p=!1)=>{var t,v;k.value=!0;try{p&&(b.current=1);const T={page:b.current,size:b.size};g.logCode&&(T.logCode=g.logCode),g.keyword&&(T.keyword=g.keyword);const{data:_}=await S.get(`/api/logs/${u.value}`,{params:T});B.value=((t=_==null?void 0:_.data)==null?void 0:t.rows)||[],M.value=((v=_==null?void 0:_.data)==null?void 0:v.total)||0}finally{k.value=!1}},j=()=>{y(!0)},A=()=>{y(!0)},I=async()=>{const p=u.value==="login"?"登录日志":u.value==="asset"?"操作日志":"告警日志";try{await q.confirm(`确认清空当前${p}？此操作不可恢复。`,"危险操作确认",{type:"warning",confirmButtonText:"确认",cancelButtonText:"取消"}),await S.delete(`/api/logs/${u.value}`),E.success("已清空"),await y(!0)}catch{}},O=async p=>{try{await q.confirm("确认删除这条日志？此操作不可恢复。","危险操作确认",{type:"warning",confirmButtonText:"确认",cancelButtonText:"取消"}),await S.delete(`/api/logs/${u.value}/${encodeURIComponent(p.logCode)}`),E.success("已删除"),await y()}catch{}};return X(y),(p,t)=>{const v=m("el-tab-pane"),T=m("el-tabs"),_=m("el-input"),w=m("el-button"),d=m("el-table-column"),z=m("el-tag"),R=m("el-table"),K=m("el-pagination"),r=m("el-descriptions-item"),F=m("el-descriptions"),H=m("el-drawer"),Q=Z("loading");return c(),f("div",te,[n("div",le,[e(T,{modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=i=>u.value=i),onTabChange:j,style:{flex:"1","min-width":"0"}},{default:o(()=>[e(v,{label:"登录日志",name:"login"}),e(v,{label:"操作日志",name:"asset"}),e(v,{label:"告警日志",name:"alarm"})]),_:1},8,["modelValue"]),e(_,{modelValue:g.logCode,"onUpdate:modelValue":t[1]||(t[1]=i=>g.logCode=i),placeholder:"日志编号",clearable:"",style:{width:"180px"},onKeyup:$(A,["enter"])},null,8,["modelValue"]),e(_,{modelValue:g.keyword,"onUpdate:modelValue":t[2]||(t[2]=i=>g.keyword=i),placeholder:"关键字",clearable:"",style:{width:"200px"},onKeyup:$(A,["enter"])},null,8,["modelValue"]),e(w,{onClick:A},{default:o(()=>[...t[11]||(t[11]=[a("查询",-1)])]),_:1}),e(w,{onClick:y},{default:o(()=>[...t[12]||(t[12]=[a("刷新",-1)])]),_:1}),e(w,{type:"danger",plain:"",onClick:I},{default:o(()=>[...t[13]||(t[13]=[a("清空",-1)])]),_:1})]),n("div",oe,[Y((c(),ee(R,{data:B.value,height:"100%",border:""},{default:o(()=>[u.value==="login"?(c(),f(x,{key:0},[e(d,{prop:"logCode",label:"日志编号",width:"220","show-overflow-tooltip":""}),e(d,{prop:"username",label:"用户名",width:"160","show-overflow-tooltip":""}),e(d,{prop:"ip",label:"IP",width:"140","show-overflow-tooltip":""}),e(d,{prop:"requestMethod",label:"方法",width:"90"}),e(d,{prop:"requestPath",label:"路径","min-width":"220","show-overflow-tooltip":""}),e(d,{prop:"costMs",label:"耗时(ms)",width:"110"}),e(d,{prop:"success",label:"结果",width:"90"},{default:o(({row:i})=>[e(z,{size:"small",type:Number(i.success)===1?"success":"danger"},{default:o(()=>[a(s(Number(i.success)===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"createdAt",label:"时间",width:"170"})],64)):u.value==="asset"?(c(),f(x,{key:1},[e(d,{prop:"logCode",label:"日志编号",width:"220","show-overflow-tooltip":""}),e(d,{prop:"assetCode",label:"对象编码",width:"240","show-overflow-tooltip":""}),e(d,{prop:"assetName",label:"对象名称","min-width":"180","show-overflow-tooltip":""}),e(d,{prop:"action",label:"操作",width:"120"},{default:o(({row:i})=>[e(z,{size:"small",effect:"plain"},{default:o(()=>[a(s(P(i.action)),1)]),_:2},1024)]),_:1}),e(d,{prop:"operator",label:"操作人",width:"140","show-overflow-tooltip":""}),e(d,{prop:"requestMethod",label:"方法",width:"90"}),e(d,{prop:"requestPath",label:"路径","min-width":"220","show-overflow-tooltip":""}),e(d,{prop:"costMs",label:"耗时(ms)",width:"110"}),e(d,{prop:"success",label:"结果",width:"90"},{default:o(({row:i})=>[e(z,{size:"small",type:Number(i.success)===1?"success":"danger"},{default:o(()=>[a(s(Number(i.success)===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"createdAt",label:"时间",width:"170"})],64)):(c(),f(x,{key:2},[e(d,{prop:"logCode",label:"日志编号",width:"220","show-overflow-tooltip":""}),e(d,{prop:"alarmType",label:"告警类型",width:"160","show-overflow-tooltip":""}),e(d,{prop:"requestMethod",label:"方法",width:"90"}),e(d,{prop:"requestPath",label:"路径","min-width":"220","show-overflow-tooltip":""}),e(d,{prop:"costMs",label:"耗时(ms)",width:"110"}),e(d,{prop:"success",label:"结果",width:"90"},{default:o(({row:i})=>[e(z,{size:"small",type:Number(i.success)===1?"success":"danger"},{default:o(()=>[a(s(Number(i.success)===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"sentAt",label:"发送时间",width:"170"})],64)),e(d,{label:"操作",width:"140",fixed:"right"},{default:o(({row:i})=>[e(w,{size:"small",text:"",onClick:G=>U(i)},{default:o(()=>[...t[14]||(t[14]=[a("详情",-1)])]),_:1},8,["onClick"]),e(w,{size:"small",text:"",type:"danger",onClick:G=>O(i)},{default:o(()=>[...t[15]||(t[15]=[a("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,k.value]])]),n("div",se,[e(K,{class:"en-pagination",layout:"total, sizes, prev, pager, next",total:M.value,"page-sizes":[20,50,100],"page-size":b.size,"current-page":b.current,"onUpdate:currentPage":t[3]||(t[3]=i=>b.current=i),onSizeChange:D,onCurrentChange:L},null,8,["total","page-size","current-page"])]),!k.value&&M.value===0?(c(),f("div",ae,"暂无数据（仅展示审计类日志）")):h("",!0),e(H,{modelValue:l.visible,"onUpdate:modelValue":t[10]||(t[10]=i=>l.visible=i),title:l.title,size:"55vw","min-size":580,"max-size":900},{footer:o(()=>[e(w,{onClick:t[9]||(t[9]=i=>l.visible=!1)},{default:o(()=>[...t[25]||(t[25]=[a("关闭",-1)])]),_:1})]),default:o(()=>[l.row?(c(),f("div",ne,[e(F,{column:1,border:""},{default:o(()=>[u.value==="login"?(c(),f(x,{key:0},[e(r,{label:"日志编号"},{default:o(()=>[a(s(l.row.logCode||"-"),1)]),_:1}),e(r,{label:"用户名"},{default:o(()=>[a(s(l.row.username),1)]),_:1}),e(r,{label:"IP"},{default:o(()=>[a(s(l.row.ip||"-"),1)]),_:1}),e(r,{label:"方法"},{default:o(()=>[n("pre",re,[n("code",null,s(l.row.requestMethod||"-"),1)])]),_:1}),e(r,{label:"路径"},{default:o(()=>[n("pre",ie,s(l.row.requestPath||"-"),1)]),_:1}),e(r,{label:"耗时(ms)"},{default:o(()=>[a(s(l.row.costMs??"-"),1)]),_:1}),e(r,{label:"结果"},{default:o(()=>[a(s(Number(l.row.success)===1?"成功":"失败"),1)]),_:1}),e(r,{label:"错误码"},{default:o(()=>[a(s(l.row.errorCode||"-"),1)]),_:1}),e(r,{label:"错误摘要"},{default:o(()=>[n("pre",de,s(l.row.errorMessage||"-"),1)]),_:1}),e(r,{label:"时间"},{default:o(()=>[a(s(l.row.createdAt||"-"),1)]),_:1}),e(r,{label:"User-Agent"},{default:o(()=>[n("pre",pe,s(l.row.userAgent||"-"),1)]),_:1})],64)):u.value==="asset"?(c(),f(x,{key:1},[e(r,{label:"日志编号"},{default:o(()=>[a(s(l.row.logCode||"-"),1)]),_:1}),e(r,{label:"对象编码"},{default:o(()=>[a(s(l.row.assetCode),1)]),_:1}),e(r,{label:"对象名称"},{default:o(()=>[a(s(l.row.assetName||"-"),1)]),_:1}),e(r,{label:"操作"},{default:o(()=>[a(s(P(l.row.action)),1)]),_:1}),e(r,{label:"操作人"},{default:o(()=>[a(s(l.row.operator||"-"),1)]),_:1}),e(r,{label:"方法"},{default:o(()=>[n("pre",ue,[n("code",null,s(l.row.requestMethod||"-"),1)])]),_:1}),e(r,{label:"路径"},{default:o(()=>[n("pre",ce,s(l.row.requestPath||"-"),1)]),_:1}),e(r,{label:"耗时(ms)"},{default:o(()=>[a(s(l.row.costMs??"-"),1)]),_:1}),e(r,{label:"结果"},{default:o(()=>[a(s(Number(l.row.success)===1?"成功":"失败"),1)]),_:1}),e(r,{label:"错误码"},{default:o(()=>[a(s(l.row.errorCode||"-"),1)]),_:1}),e(r,{label:"错误摘要"},{default:o(()=>[n("pre",fe,s(l.row.errorMessage||"-"),1)]),_:1}),e(r,{label:"时间"},{default:o(()=>[a(s(l.row.createdAt||"-"),1)]),_:1})],64)):(c(),f(x,{key:2},[e(r,{label:"日志编号"},{default:o(()=>[a(s(l.row.logCode||"-"),1)]),_:1}),e(r,{label:"告警类型"},{default:o(()=>[a(s(l.row.alarmType),1)]),_:1}),e(r,{label:"方法"},{default:o(()=>[n("pre",we,[n("code",null,s(l.row.requestMethod||"-"),1)])]),_:1}),e(r,{label:"路径"},{default:o(()=>[n("pre",me,s(l.row.requestPath||"-"),1)]),_:1}),e(r,{label:"耗时(ms)"},{default:o(()=>[a(s(l.row.costMs??"-"),1)]),_:1}),e(r,{label:"结果"},{default:o(()=>[a(s(Number(l.row.success)===1?"成功":"失败"),1)]),_:1}),e(r,{label:"错误码"},{default:o(()=>[a(s(l.row.errorCode||"-"),1)]),_:1}),e(r,{label:"错误摘要"},{default:o(()=>[n("pre",_e,s(l.row.errorMessage||"-"),1)]),_:1}),e(r,{label:"发送时间"},{default:o(()=>[a(s(l.row.sentAt||"-"),1)]),_:1})],64))]),_:1}),u.value==="asset"?(c(),f(x,{key:0},[t[18]||(t[18]=n("div",{class:"en-muted",style:{"font-size":"12px"}},"变更前",-1)),n("div",be,[e(w,{size:"small",onClick:t[4]||(t[4]=i=>C(l.beforeText))},{default:o(()=>[...t[16]||(t[16]=[a("复制",-1)])]),_:1})]),n("pre",ge,[n("code",null,s(l.beforeText),1)]),t[19]||(t[19]=n("div",{class:"en-muted",style:{"font-size":"12px"}},"变更后",-1)),n("div",ye,[e(w,{size:"small",onClick:t[5]||(t[5]=i=>C(l.afterText))},{default:o(()=>[...t[17]||(t[17]=[a("复制",-1)])]),_:1})]),n("pre",xe,[n("code",null,s(l.afterText),1)])],64)):u.value==="alarm"?(c(),f(x,{key:1},[t[22]||(t[22]=n("div",{class:"en-muted",style:{"font-size":"12px"}},"内容",-1)),n("div",ve,[e(w,{size:"small",onClick:t[6]||(t[6]=i=>C(l.contentText))},{default:o(()=>[...t[20]||(t[20]=[a("复制",-1)])]),_:1})]),n("pre",he,[n("code",null,s(l.contentText),1)]),t[23]||(t[23]=n("div",{class:"en-muted",style:{"font-size":"12px"}},"响应",-1)),n("div",Ce,[e(w,{size:"small",onClick:t[7]||(t[7]=i=>C(l.responseText))},{default:o(()=>[...t[21]||(t[21]=[a("复制",-1)])]),_:1})]),n("pre",Te,[n("code",null,s(l.responseText),1)])],64)):h("",!0),l.detailJsonText?(c(),f("div",ke,"详情(JSON)")):h("",!0),l.detailJsonText?(c(),f("div",ze,[e(w,{size:"small",onClick:t[8]||(t[8]=i=>C(l.detailJsonText))},{default:o(()=>[...t[24]||(t[24]=[a("复制",-1)])]),_:1})])):h("",!0),l.detailJsonText?(c(),f("pre",Ne,[n("code",null,s(l.detailJsonText),1)])):h("",!0)])):h("",!0)]),_:1},8,["modelValue","title"])])}}},Ae=W(Ee,[["__scopeId","data-v-efc81a71"]]);export{Ae as default};
