import{_ as F,a as U,r as C,k as x,o as W,c as q,d as p,e as l,l as G,f as c,w as n,F as O,h as g,g as J,j as d,t as K,E as u,x as E}from"./index-BEN9G-LX.js";const Q={class:"en-page"},Z={class:"en-toolbar"},ee={class:"en-table-wrap"},te={style:{display:"flex","align-items":"center",gap:"8px"}},le={style:{"min-width":"0",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},oe={style:{display:"flex","justify-content":"flex-end","margin-bottom":"8px"}},ne={class:"en-code"},ae={style:{display:"flex","justify-content":"flex-end","margin-bottom":"8px"}},se={class:"en-code"},ie={__name:"SystemApiKeys",setup(de){const V=U([]),f=C({keyword:"",enabled:void 0}),b=U(new Set),h=x(()=>Array.from(b.value).length),i=C({visible:!1,loading:!1,form:{note:"",enabled:0}}),r=C({visible:!1,tab:"curl",curl:"",http:""}),k=x(()=>{var t;return((t=window.location)==null?void 0:t.origin)||""}),y=async()=>{const{data:t}=await g.get("/api/system/api-keys");V.value=(t==null?void 0:t.data)||[],b.value=new Set},A=x(()=>{const t=String(f.keyword||"").trim().toLowerCase();return V.value.filter(e=>{if((f.enabled===0||f.enabled===1)&&Number(e.enabled??0)!==Number(f.enabled))return!1;if(!t)return!0;const s=String(e.note||"").toLowerCase(),a=String(e.apiKey||"").toLowerCase();return s.includes(t)||a.includes(t)})}),T=t=>{const e=new Set(A.value.map(a=>a.id)),s=new Set(b.value);for(const a of e)s.delete(a);for(const a of t||[])(a==null?void 0:a.id)!=null&&s.add(a.id);b.value=s},z=async t=>{var e,s;if((t==null?void 0:t.id)!=null){try{await E.confirm(`确认删除 API Key ${t.note||t.apiKey}？`,"删除确认",{type:"warning"})}catch{return}try{await g.delete(`/api/system/api-keys/${encodeURIComponent(t.id)}`),u.success("已删除"),b.value.delete(t.id),await y()}catch(a){u.error(((s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.message)||"删除失败")}}},B=async()=>{var e,s;const t=Array.from(b.value);if(t.length!==0){try{await E.confirm(`确认删除选中的 ${t.length} 个 API Key？`,"删除确认",{type:"warning"})}catch{return}try{await g.post("/api/system/api-keys/batch-delete",{ids:t}),u.success("已删除"),b.value=new Set,await y()}catch(a){u.error(((s=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:s.message)||"删除失败")}}},R=()=>{const t=k.value.replace(/^https?:\/\//,"");r.tab="curl",r.curl=`curl -s \\
  -H "X-API-Key: <API_KEY>" \\
  "${k.value}/openapi/assets?assetType=WEB_APP&importance=核心业务"

# 也可以不带过滤参数（返回全部资产）
curl -s -H "X-API-Key: <API_KEY>" "${k.value}/openapi/assets"`,r.http=`GET /openapi/assets?assetType=WEB_APP&importance=核心业务 HTTP/1.1
Host: ${t}
X-API-Key: <API_KEY>
Accept: application/json
Connection: close
`,r.visible=!0},H=()=>{i.form={note:"外部资产查询",enabled:0},i.visible=!0},_=async t=>{const e=String(t||"");if(e)try{await navigator.clipboard.writeText(e),u.success("已复制")}catch{u.error("复制失败")}},N=async()=>{var t,e;if(!String(i.form.note||"").trim()){u.error("名称不能为空");return}i.loading=!0;try{const{data:s}=await g.post("/api/system/api-keys",{enabled:i.form.enabled,note:i.form.note.trim()}),a=s==null?void 0:s.data;i.visible=!1,a!=null&&a.apiKey&&await _(a.apiKey),u.success("已创建"),await y()}catch(s){u.error(((e=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:e.message)||"创建失败")}finally{i.loading=!1}},j=async t=>{try{await g.post(`/api/system/api-keys/${encodeURIComponent(t.id)}/enabled`,{enabled:t.enabled}),u.success("已更新")}catch{u.error("更新失败"),await y()}},Y=async t=>{try{await g.post(`/api/system/api-keys/${encodeURIComponent(t.id)}/rotate`),u.success("已轮换"),await y()}catch{u.error("轮换失败")}};return W(y),(t,e)=>{const s=c("el-input"),a=c("el-option"),L=c("el-select"),m=c("el-button"),v=c("el-table-column"),P=c("el-switch"),M=c("el-table"),I=c("el-form-item"),X=c("el-form"),S=c("el-dialog"),$=c("el-tab-pane"),D=c("el-tabs");return J(),q(O,null,[p("div",Q,[p("div",Z,[l(s,{modelValue:f.keyword,"onUpdate:modelValue":e[0]||(e[0]=o=>f.keyword=o),placeholder:"搜索 名称/API Key",clearable:"",style:{width:"260px"},onKeyup:G(y,["enter"])},null,8,["modelValue"]),l(L,{modelValue:f.enabled,"onUpdate:modelValue":e[1]||(e[1]=o=>f.enabled=o),placeholder:"启用状态",clearable:"",style:{width:"140px"}},{default:n(()=>[l(a,{label:"启用",value:1}),l(a,{label:"停用",value:0})]),_:1},8,["modelValue"]),l(m,{onClick:y},{default:n(()=>[...e[11]||(e[11]=[d("刷新",-1)])]),_:1}),e[15]||(e[15]=p("div",{class:"spacer"},null,-1)),l(m,{onClick:R},{default:n(()=>[...e[12]||(e[12]=[d("API 文档",-1)])]),_:1}),l(m,{type:"danger",plain:"",disabled:h.value===0,onClick:B},{default:n(()=>[...e[13]||(e[13]=[d("批量删除",-1)])]),_:1},8,["disabled"]),l(m,{type:"primary",onClick:H},{default:n(()=>[...e[14]||(e[14]=[d("创建 Key",-1)])]),_:1})]),p("div",ee,[l(M,{data:A.value,height:"100%",border:"","row-key":"id","reserve-selection":!0,onSelectionChange:T},{default:n(()=>[l(v,{type:"selection",width:"46"}),l(v,{prop:"note",label:"名称","min-width":"200","show-overflow-tooltip":""}),l(v,{prop:"apiKey",label:"API Key","min-width":"360","show-overflow-tooltip":""},{default:n(({row:o})=>[p("div",te,[p("span",le,K(o.apiKey),1),l(m,{size:"small",text:"",onClick:w=>_(o.apiKey)},{default:n(()=>[...e[16]||(e[16]=[d("复制",-1)])]),_:1},8,["onClick"])])]),_:1}),l(v,{prop:"enabled",label:"启用",width:"90"},{default:n(({row:o})=>[l(P,{modelValue:o.enabled,"onUpdate:modelValue":w=>o.enabled=w,"active-value":1,"inactive-value":0,onChange:w=>j(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(v,{prop:"updatedAt",label:"更新时间",width:"170"}),l(v,{label:"操作",width:"200",fixed:"right"},{default:n(({row:o})=>[l(m,{size:"small",onClick:w=>Y(o)},{default:n(()=>[...e[17]||(e[17]=[d("轮换",-1)])]),_:1},8,["onClick"]),l(m,{size:"small",type:"danger",plain:"",onClick:w=>z(o)},{default:n(()=>[...e[18]||(e[18]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),l(S,{modelValue:i.visible,"onUpdate:modelValue":e[5]||(e[5]=o=>i.visible=o),title:"创建 API Key",width:"560px"},{footer:n(()=>[l(m,{disabled:i.loading,onClick:e[4]||(e[4]=o=>i.visible=!1)},{default:n(()=>[...e[19]||(e[19]=[d("取消",-1)])]),_:1},8,["disabled"]),l(m,{type:"primary",loading:i.loading,onClick:N},{default:n(()=>[...e[20]||(e[20]=[d("创建",-1)])]),_:1},8,["loading"])]),default:n(()=>[l(X,{model:i.form,"label-width":"90px"},{default:n(()=>[l(I,{label:"名称",required:""},{default:n(()=>[l(s,{modelValue:i.form.note,"onUpdate:modelValue":e[2]||(e[2]=o=>i.form.note=o),placeholder:"例如：外部资产查询（生产）"},null,8,["modelValue"])]),_:1}),l(I,{label:"启用"},{default:n(()=>[l(P,{modelValue:i.form.enabled,"onUpdate:modelValue":e[3]||(e[3]=o=>i.form.enabled=o),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(S,{modelValue:r.visible,"onUpdate:modelValue":e[10]||(e[10]=o=>r.visible=o),title:"API Key 使用说明（外部只读）",width:"860px"},{footer:n(()=>[l(m,{onClick:e[9]||(e[9]=o=>r.visible=!1)},{default:n(()=>[...e[25]||(e[25]=[d("关闭",-1)])]),_:1})]),default:n(()=>[l(D,{modelValue:r.tab,"onUpdate:modelValue":e[8]||(e[8]=o=>r.tab=o)},{default:n(()=>[l($,{label:"curl 示例",name:"curl"},{default:n(()=>[e[22]||(e[22]=p("div",{class:"en-muted",style:{"font-size":"12px","margin-bottom":"8px"}},[d("把 "),p("span",{class:"en-mono"},"<API_KEY>"),d(" 替换为你创建的 key")],-1)),p("div",oe,[l(m,{size:"small",onClick:e[6]||(e[6]=o=>_(r.curl))},{default:n(()=>[...e[21]||(e[21]=[d("复制",-1)])]),_:1})]),p("pre",ne,K(r.curl),1)]),_:1}),l($,{label:"HTTP 请求包",name:"http"},{default:n(()=>[e[24]||(e[24]=p("div",{class:"en-muted",style:{"font-size":"12px","margin-bottom":"8px"}},"可直接用于 Burp Repeater / Postman Raw",-1)),p("div",ae,[l(m,{size:"small",onClick:e[7]||(e[7]=o=>_(r.http))},{default:n(()=>[...e[23]||(e[23]=[d("复制",-1)])]),_:1})]),p("pre",se,K(r.http),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])],64)}}},pe=F(ie,[["__scopeId","data-v-c21e50fa"]]);export{pe as default};
