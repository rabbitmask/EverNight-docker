import{a as _,r as z,o as D,c as K,d as f,e as s,w as l,f as u,l as U,h as g,g as B,j as c,t as k,x as C,E as m}from"./index-BEN9G-LX.js";import{g as M}from"./bizDict-CVILYPll.js";const L={class:"en-page"},F={class:"en-toolbar"},j={class:"en-table-wrap"},Q={class:"en-footer"},J={__name:"AssetRevives",setup(Y){const b=_([]),y=_(0),r=z({status:"",keyword:""}),w=_([]),d=z({current:1,size:20}),p=async()=>{var o,a;const t={page:d.current,size:d.size};r.status&&(t.status=r.status),r.keyword&&(t.keyword=r.keyword);const{data:e}=await g.get("/api/assets/revive-events",{params:t});b.value=((o=e==null?void 0:e.data)==null?void 0:o.rows)||[],y.value=((a=e==null?void 0:e.data)==null?void 0:a.total)||0},N=async()=>{d.current=1,await p()},R=t=>{d.size=t,d.current=1,p()},I=()=>{p()},V=t=>t==="PENDING"?"待处理":t==="RESTORED"?"已恢复":t==="IGNORED"?"已忽略":t||"未知",S=t=>t==="PENDING"?"warning":t==="RESTORED"?"success":"info",x=t=>{const e=w.value.find(o=>o.itemCode===t);return(e==null?void 0:e.itemName)||t||"-"},O=async t=>{var e,o;try{const{value:a}=await C.prompt("可选：填写恢复说明","恢复资产",{inputValue:""});await g.post(`/api/assets/revive-events/${encodeURIComponent(t.reviveCode)}/restore`,{note:a}),m.success("已恢复"),await p()}catch(a){if(a==="cancel"||a==="close")return;m.error(((o=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:o.message)||"恢复失败")}},P=async t=>{var e,o;try{const{value:a}=await C.prompt("可选：填写忽略原因","忽略复活事件",{inputValue:""});await g.post(`/api/assets/revive-events/${encodeURIComponent(t.reviveCode)}/ignore`,{note:a}),m.success("已忽略"),await p()}catch(a){if(a==="cancel"||a==="close")return;m.error(((o=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:o.message)||"忽略失败")}},G=async t=>{var e,o;if(t!=null&&t.reviveCode){try{await C.confirm(`确认删除复活事件 ${t.reviveCode}？此操作不可恢复。`,"删除确认",{type:"warning"})}catch{return}try{await g.delete(`/api/assets/revive-events/${encodeURIComponent(t.reviveCode)}`),m.success("已删除"),await p()}catch(a){m.error(((o=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:o.message)||"删除失败")}}};return D(p),D(async()=>{try{w.value=await M("CLAIM_DISCOVERED_TYPE")}catch{w.value=[{itemCode:"PORT",itemName:"端口扫描"},{itemCode:"DNS",itemName:"DNS爆破"},{itemCode:"CRT",itemName:"证书透明度查询"},{itemCode:"FOFA",itemName:"网络空间搜索引擎"}]}}),(t,e)=>{const o=u("el-option"),a=u("el-select"),T=u("el-input"),v=u("el-button"),i=u("el-table-column"),h=u("el-tag"),A=u("el-table"),$=u("el-pagination");return B(),K("div",L,[f("div",F,[s(a,{modelValue:r.status,"onUpdate:modelValue":e[0]||(e[0]=n=>r.status=n),placeholder:"处理状态",clearable:"",style:{width:"180px"}},{default:l(()=>[s(o,{label:"待处理",value:"PENDING"}),s(o,{label:"已恢复",value:"RESTORED"}),s(o,{label:"已忽略",value:"IGNORED"})]),_:1},8,["modelValue"]),s(T,{modelValue:r.keyword,"onUpdate:modelValue":e[1]||(e[1]=n=>r.keyword=n),placeholder:"搜索 资产编码/地址",clearable:"",style:{width:"260px"},onKeyup:U(N,["enter"])},null,8,["modelValue"]),s(v,{onClick:N},{default:l(()=>[...e[3]||(e[3]=[c("查询",-1)])]),_:1}),e[5]||(e[5]=f("div",{class:"spacer"},null,-1)),s(v,{onClick:p},{default:l(()=>[...e[4]||(e[4]=[c("刷新",-1)])]),_:1})]),f("div",j,[s(A,{data:b.value,height:"100%",border:""},{default:l(()=>[s(i,{prop:"reviveCode",label:"事件编号",width:"240","show-overflow-tooltip":""}),s(i,{prop:"assetCode",label:"资产编码",width:"220","show-overflow-tooltip":""}),s(i,{prop:"assetName",label:"资产名称","min-width":"160","show-overflow-tooltip":""}),s(i,{prop:"assetAddress",label:"资产地址","min-width":"220","show-overflow-tooltip":""}),s(i,{prop:"discoveredAddress",label:"命中地址","min-width":"220","show-overflow-tooltip":""}),s(i,{prop:"sourceScanKind",label:"来源扫描",width:"120"},{default:l(({row:n})=>[s(h,{size:"small",effect:"plain"},{default:l(()=>[c(k(x(n.sourceScanKind)),1)]),_:2},1024)]),_:1}),s(i,{prop:"status",label:"状态",width:"110"},{default:l(({row:n})=>[s(h,{size:"small",type:S(n.status)},{default:l(()=>[c(k(V(n.status)),1)]),_:2},1032,["type"])]),_:1}),s(i,{prop:"detectedAt",label:"发现时间",width:"170"}),s(i,{prop:"handledAt",label:"处理时间",width:"170"}),s(i,{label:"操作",width:"200",fixed:"right"},{default:l(({row:n})=>[s(v,{size:"small",type:"primary",disabled:n.status!=="PENDING",onClick:E=>O(n)},{default:l(()=>[...e[6]||(e[6]=[c("恢复",-1)])]),_:1},8,["disabled","onClick"]),s(v,{size:"small",disabled:n.status!=="PENDING",onClick:E=>P(n)},{default:l(()=>[...e[7]||(e[7]=[c("忽略",-1)])]),_:1},8,["disabled","onClick"]),s(v,{size:"small",type:"danger",plain:"",onClick:E=>G(n)},{default:l(()=>[...e[8]||(e[8]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),f("div",Q,[s($,{class:"en-pagination",layout:"total, sizes, prev, pager, next",total:y.value,"page-sizes":[20,50,100],"page-size":d.size,"current-page":d.current,"onUpdate:currentPage":e[2]||(e[2]=n=>d.current=n),onSizeChange:R,onCurrentChange:I},null,8,["total","page-size","current-page"])])])}}};export{J as default};
