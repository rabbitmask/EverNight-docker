import{_ as z}from"./DictItemManager-BpB3DTG1.js";import{a as N,r as U,k as Z,z as ee,o as te,f as i,c as A,g as R,d as h,e as t,l as le,w as o,j as u,t as S,h as v,n as M,E as m,x as H}from"./index-8jM1g0LY.js";const ae={style:{display:"flex","flex-direction":"column","min-height":"0",gap:"12px"}},oe={class:"en-toolbar",style:{padding:"0"}},ne={class:"en-table-wrap"},re={class:"en-footer",style:{"padding-top":"4px"}},se={__name:"FingerprintManager",setup(E){const b=N([]),c=U({keyword:"",enabled:void 0}),s=U({current:1,size:20,total:0}),x=N(),f=N(new Set),I=Z(()=>Array.from(f.value).length),a=U({visible:!1,loading:!1,mode:"create",id:null,form:{cmsName:"",headerText:"",titleText:"",bodyText:"",favText:"",enabled:1}}),p=async()=>{try{const{data:l}=await v.get("/api/fingerprints",{params:{keyword:c.keyword,enabled:c.enabled,page:s.current,size:s.size}}),e=(l==null?void 0:l.data)||{};b.value=e.rows||[],s.total=Number(e.total||0),await M(),$()}catch{m.error("加载失败")}},J=()=>{s.current=1,p()},F=()=>{p()},P=async l=>{try{await v.post(`/api/fingerprints/${encodeURIComponent(l.id)}/enabled`,{enabled:l.enabled}),m.success("已更新")}catch{m.error("更新失败"),await p()}},D=()=>{a.mode="create",a.id=null,a.form={cmsName:"",headerText:"",titleText:"",bodyText:"",favText:"",enabled:1},a.visible=!0},K=l=>{a.mode="edit",a.id=l.id,a.form={cmsName:l.cmsName||"",headerText:V(l.keywordHeader),titleText:V(l.keywordTitle),bodyText:V(l.keywordBody),favText:V(l.faviconHash),enabled:l.enabled??1},a.visible=!0},L=async()=>{var l,e;if(!String(a.form.cmsName||"").trim()){m.error("CMS 名称不能为空");return}a.loading=!0;try{const r={cmsName:a.form.cmsName.trim(),keywordHeader:w(a.form.headerText),keywordTitle:w(a.form.titleText),keywordBody:w(a.form.bodyText),faviconHash:w(a.form.favText),enabled:a.form.enabled};a.mode==="create"?await v.post("/api/fingerprints",r):await v.put(`/api/fingerprints/${encodeURIComponent(a.id)}`,r),m.success("已保存"),a.visible=!1,s.current=1,await p()}catch(r){m.error(((e=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:e.message)||"保存失败")}finally{a.loading=!1}},O=async l=>{var e,r;if(l!=null&&l.id){try{await H.confirm(`确认删除指纹 ${l.cmsName||l.id}？此操作不可恢复。`,"删除确认",{type:"warning"})}catch{return}try{await v.delete(`/api/fingerprints/${encodeURIComponent(l.id)}`),m.success("已删除"),f.value.delete(l.id),await p()}catch(d){m.error(((r=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:r.message)||"删除失败")}}},W=async()=>{var e,r;const l=Array.from(f.value);if(l.length!==0){try{await H.confirm(`确认删除选中的 ${l.length} 条指纹？此操作不可恢复。`,"删除确认",{type:"warning"})}catch{return}try{await v.post("/api/fingerprints/batch-delete",{ids:l}),m.success("已删除"),f.value=new Set,s.current=1,await p()}catch(d){m.error(((r=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:r.message)||"删除失败")}}},j=l=>{const e=new Set(b.value.map(d=>d.id)),r=new Set(f.value);for(const d of e)r.delete(d);for(const d of l||[])(d==null?void 0:d.id)!=null&&r.add(d.id);f.value=r},$=()=>{const l=x.value;if(l)try{l.clearSelection();for(const e of b.value)f.value.has(e.id)&&l.toggleRowSelection(e,!0)}catch{}},w=l=>l?l.split(/\r?\n/).map(e=>String(e||"").trim()).filter(e=>e&&!e.startsWith("#")):[],V=l=>{if(!l)return"";try{const e=JSON.parse(l);return Array.isArray(e)?e.filter(Boolean).join(`
`):""}catch{return""}},k=l=>{if(!l)return 0;try{const e=JSON.parse(l);return Array.isArray(e)?e.length:0}catch{return 0}};return ee(()=>[s.current,s.size,b.value.length],async()=>{await M(),$()}),te(p),(l,e)=>{const r=i("el-input"),d=i("el-option"),q=i("el-select"),y=i("el-button"),g=i("el-table-column"),C=i("el-tag"),B=i("el-switch"),G=i("el-table"),Q=i("el-pagination"),_=i("el-form-item"),X=i("el-form"),Y=i("el-dialog");return R(),A("div",ae,[h("div",oe,[t(r,{modelValue:c.keyword,"onUpdate:modelValue":e[0]||(e[0]=n=>c.keyword=n),placeholder:"搜索 CMS/关键字/favhash",clearable:"",style:{width:"260px"},onKeyup:le(p,["enter"])},null,8,["modelValue"]),t(q,{modelValue:c.enabled,"onUpdate:modelValue":e[1]||(e[1]=n=>c.enabled=n),placeholder:"启用状态",clearable:"",style:{width:"160px"}},{default:o(()=>[t(d,{label:"启用",value:1}),t(d,{label:"停用",value:0})]),_:1},8,["modelValue"]),t(y,{onClick:p},{default:o(()=>[...e[12]||(e[12]=[u("查询",-1)])]),_:1}),t(y,{type:"danger",plain:"",disabled:I.value===0,onClick:W},{default:o(()=>[...e[13]||(e[13]=[u("批量删除",-1)])]),_:1},8,["disabled"]),e[16]||(e[16]=h("div",{class:"spacer"},null,-1)),t(y,{onClick:p},{default:o(()=>[...e[14]||(e[14]=[u("刷新",-1)])]),_:1}),t(y,{type:"primary",onClick:D},{default:o(()=>[...e[15]||(e[15]=[u("新增指纹",-1)])]),_:1})]),h("div",ne,[t(G,{ref_key:"tableRef",ref:x,data:b.value,height:"100%",border:"","row-key":"id","reserve-selection":!0,onSelectionChange:j},{default:o(()=>[t(g,{type:"selection",width:"46"}),t(g,{prop:"cmsName",label:"CMS 名称","min-width":"220","show-overflow-tooltip":""}),t(g,{label:"规则",width:"220"},{default:o(({row:n})=>[t(C,{size:"small",effect:"plain"},{default:o(()=>[u("H "+S(k(n.keywordHeader)),1)]),_:2},1024),t(C,{size:"small",effect:"plain",style:{"margin-left":"6px"}},{default:o(()=>[u("T "+S(k(n.keywordTitle)),1)]),_:2},1024),t(C,{size:"small",effect:"plain",style:{"margin-left":"6px"}},{default:o(()=>[u("B "+S(k(n.keywordBody)),1)]),_:2},1024),t(C,{size:"small",effect:"plain",style:{"margin-left":"6px"}},{default:o(()=>[u("F "+S(k(n.faviconHash)),1)]),_:2},1024)]),_:1}),t(g,{prop:"enabled",label:"启用",width:"90"},{default:o(({row:n})=>[t(B,{modelValue:n.enabled,"onUpdate:modelValue":T=>n.enabled=T,"active-value":1,"inactive-value":0,onChange:T=>P(n)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(g,{prop:"updatedAt",label:"更新时间",width:"170"}),t(g,{label:"操作",width:"220",fixed:"right"},{default:o(({row:n})=>[t(y,{size:"small",onClick:T=>K(n)},{default:o(()=>[...e[17]||(e[17]=[u("编辑",-1)])]),_:1},8,["onClick"]),t(y,{size:"small",type:"danger",plain:"",onClick:T=>O(n)},{default:o(()=>[...e[18]||(e[18]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),h("div",re,[t(Q,{layout:"total, sizes, prev, pager, next",total:s.total,"page-size":s.size,"page-sizes":[10,20,50,100],"current-page":s.current,"onUpdate:currentPage":e[2]||(e[2]=n=>s.current=n),"onUpdate:pageSize":e[3]||(e[3]=n=>s.size=n),onSizeChange:J,onCurrentChange:F},null,8,["total","page-size","current-page"])]),t(Y,{modelValue:a.visible,"onUpdate:modelValue":e[11]||(e[11]=n=>a.visible=n),title:a.mode==="create"?"新增指纹":"编辑指纹",width:"760px"},{footer:o(()=>[t(y,{disabled:a.loading,onClick:e[10]||(e[10]=n=>a.visible=!1)},{default:o(()=>[...e[19]||(e[19]=[u("取消",-1)])]),_:1},8,["disabled"]),t(y,{type:"primary",loading:a.loading,onClick:L},{default:o(()=>[...e[20]||(e[20]=[u("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(X,{model:a.form,"label-width":"120px"},{default:o(()=>[t(_,{label:"CMS 名称"},{default:o(()=>[t(r,{modelValue:a.form.cmsName,"onUpdate:modelValue":e[4]||(e[4]=n=>a.form.cmsName=n),placeholder:"例如：WordPress / Jenkins"},null,8,["modelValue"])]),_:1}),t(_,{label:"Header 关键字"},{default:o(()=>[t(r,{modelValue:a.form.headerText,"onUpdate:modelValue":e[5]||(e[5]=n=>a.form.headerText=n),type:"textarea",rows:4,placeholder:"每行一个关键字"},null,8,["modelValue"])]),_:1}),t(_,{label:"Title 关键字"},{default:o(()=>[t(r,{modelValue:a.form.titleText,"onUpdate:modelValue":e[6]||(e[6]=n=>a.form.titleText=n),type:"textarea",rows:4,placeholder:"每行一个关键字"},null,8,["modelValue"])]),_:1}),t(_,{label:"Body 关键字"},{default:o(()=>[t(r,{modelValue:a.form.bodyText,"onUpdate:modelValue":e[7]||(e[7]=n=>a.form.bodyText=n),type:"textarea",rows:4,placeholder:"每行一个关键字"},null,8,["modelValue"])]),_:1}),t(_,{label:"FaviconHash"},{default:o(()=>[t(r,{modelValue:a.form.favText,"onUpdate:modelValue":e[8]||(e[8]=n=>a.form.favText=n),type:"textarea",rows:3,placeholder:"每行一个 hash（favicon.ico 的 MD5，小写 hex）"},null,8,["modelValue"])]),_:1}),t(_,{label:"启用"},{default:o(()=>[t(B,{modelValue:a.form.enabled,"onUpdate:modelValue":e[9]||(e[9]=n=>a.form.enabled=n),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},de={class:"en-page"},ie={class:"en-card-body",style:{"min-height":"0"}},me={__name:"AssessConfig",setup(E){return(b,c)=>{const s=i("el-tab-pane"),x=i("el-tabs"),f=i("el-card");return R(),A("div",de,[t(x,{style:{flex:"1","min-height":"0"}},{default:o(()=>[t(s,{label:"评估字典"},{default:o(()=>[t(x,null,{default:o(()=>[t(s,{label:"管理路径"},{default:o(()=>[t(z,{code:"admin_path","value-label":"路径","value-placeholder":"/admin","search-placeholder":"搜索 路径/规则"})]),_:1}),t(s,{label:"敏感路径"},{default:o(()=>[t(z,{code:"sensitive_path","value-label":"路径","value-placeholder":"/.env","search-placeholder":"搜索 路径/规则"})]),_:1}),t(s,{label:"高危端口"},{default:o(()=>[t(z,{code:"high_risk_ports","value-label":"端口","value-type":"port","value-placeholder":"例如：3306","search-placeholder":"搜索 端口/规则"})]),_:1})]),_:1})]),_:1}),t(s,{label:"框架指纹"},{default:o(()=>[t(f,{class:"en-card-fill",shadow:"never"},{header:o(()=>[...c[0]||(c[0]=[h("div",{style:{"font-weight":"700"}},"框架/CMS 指纹库",-1)])]),default:o(()=>[h("div",ie,[t(se)])]),_:1})]),_:1})]),_:1})])}}};export{me as default};
