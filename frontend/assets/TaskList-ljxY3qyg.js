import{_ as dt,y as ut,k as J,a as N,r as P,z as mt,o as I,h as E,f as k,c as h,g as y,d as m,e as s,w as n,l as pt,j as p,t as g,p as T,v as _,B,F as re,m as Ne,n as X,E as C,x as be}from"./index-BFugLfXi.js";import{g as G}from"./bizDict-BGApEC7U.js";const ct={class:"en-page"},ft={class:"en-toolbar"},yt={class:"en-table-wrap"},kt={style:{display:"flex","justify-content":"flex-end",padding:"12px 0 2px"}},St={style:{display:"flex",gap:"10px",width:"100%","flex-wrap":"wrap"}},vt={class:"en-muted",style:{"font-size":"12px","line-height":"32px"}},Ct={style:{display:"flex","align-items":"center",gap:"10px","flex-wrap":"wrap"}},gt={style:{width:"100%"}},Tt={class:"en-assess-rules"},Nt={class:"en-task-panel en-task-panel--tall"},bt={key:0,class:"en-task-step"},wt={class:"en-choice-grid"},ht={class:"en-choice-title"},_t={class:"en-choice-title"},At={class:"en-choice-title"},Et={class:"en-choice-title"},xt={class:"en-task-actions"},Ot={key:1,class:"en-task-step"},Vt={class:"en-task-step-head"},Rt={key:0,class:"en-muted",style:{"font-size":"12px","margin-top":"6px"}},Dt={key:1,class:"en-muted",style:{"font-size":"12px","margin-top":"6px"}},Pt={key:2,class:"en-muted",style:{"font-size":"12px","margin-top":"6px"}},Ft={key:3,style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},Mt={key:4,style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},Ut={key:5,style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},It={class:"en-task-panel"},Lt={style:{display:"flex","align-items":"center",gap:"8px"}},zt={class:"en-toolbar",style:{padding:"0"}},Ht={class:"en-table-wrap",style:{"margin-top":"10px"}},qt={style:{display:"flex","justify-content":"flex-end",padding:"12px 0 2px"}},Kt={__name:"TaskList",props:{fixedType:{type:String,default:""},defaultName:{type:String,default:""},defaultParamsJson:{type:String,default:""}},setup(we){const M=we,de=ut(),j=J(()=>!!M.fixedType),L=N([]),ue=N(0),Q=N([]),z=N([]),Z=N([]),ee=N([]),te=N([]),he=J(()=>Array.from(O.value).length),_e=t=>{const e=String(t||"").trim();if(!e)return"-";const l=z.value.find(i=>String(i.itemCode||"")===e);return(l==null?void 0:l.itemName)||e},b=P({taskType:M.fixedType||"",enabled:void 0,keyword:""}),x=P({current:1,size:20}),me=N(),O=N(new Set),pe=N(),Ae={taskName:[{required:!0,message:"任务名称不能为空",trigger:"blur"}],scheduleFrequency:[{required:!0,message:"频率不能为空",trigger:"change"}]},r=P({visible:!1,loading:!1,mode:"create",taskCode:"",form:{}}),S=P({time:"02:00",weeklyDow:"MON",monthlyDom:1}),o=P({kind:"",ip:"",domain:"",query:"",maxSize:100,range:"COMMON",timeoutSec:10,concurrency:100,portsText:""}),V=N(1),w=P({assetCodes:[],ruleCodes:["HIGH_RISK_PORT_OPEN","ADMIN_PATH_EXPOSED","SENSITIVE_PATH_EXPOSED","FRAMEWORK_FINGERPRINT_EXPOSED"]}),H=N([]),ce=N(0),U=P({visible:!1,rows:[]}),fe=N(),c=P({visible:!1,keyword:"",assetType:"",importance:"",page:1,pageSize:8}),F=N(new Set),R=async(t=!1)=>{var i,d;const e={page:x.current,size:x.size};b.taskType&&(e.taskType=b.taskType),(b.enabled===0||b.enabled===1)&&(e.enabled=b.enabled),b.keyword&&(e.keyword=b.keyword);const{data:l}=await E.get("/api/tasks",{params:e});L.value=((i=l==null?void 0:l.data)==null?void 0:i.rows)||[],ue.value=((d=l==null?void 0:l.data)==null?void 0:d.total)||0,t&&(O.value=new Set),await X(),le()},ye=async()=>{x.current=1,await R(!0)},se=async(t=!1)=>{var i,d;t&&(c.page=1);const e={page:c.page,size:c.pageSize};c.assetType&&(e.assetType=c.assetType),c.importance&&(e.importance=c.importance),c.keyword&&(e.keyword=c.keyword);const{data:l}=await E.get("/api/assets",{params:e});H.value=((i=l==null?void 0:l.data)==null?void 0:i.rows)||[],ce.value=((d=l==null?void 0:l.data)==null?void 0:d.total)||0,await X(),et()},Ee=t=>{x.size=t,x.current=1,R()},xe=()=>{R()},Oe=t=>{const e=new Set(L.value.map(i=>i.taskCode)),l=new Set(O.value);for(const i of e)l.delete(i);for(const i of t||[])i!=null&&i.taskCode&&l.add(i.taskCode);O.value=l},le=()=>{const t=me.value;if(t)try{t.clearSelection();for(const e of L.value)O.value.has(e.taskCode)&&t.toggleRowSelection(e,!0)}catch{}},ke=t=>{if(!t)return{};try{const e=JSON.parse(t);return e&&typeof e=="object"?e:{}}catch{return{}}},D=t=>{const e=ee.value.find(l=>l.itemCode===t);return e!=null&&e.itemName?e.itemName:t==="PORT"?"端口扫描":t==="DNS"?"DNS爆破":t==="CRT"?"CT查询":t==="FOFA"?"网络空间搜索":t||""},Ve=t=>{const e=String((t==null?void 0:t.taskType)||"");return e==="SCAN"?"扫描":e==="ASSESS"?"评估":e==="ALARM"?"告警":e||"未知"},Re=t=>{const e=String(t||"").trim();if(!e)return"";const l=te.value.find(i=>i.ruleCode===e);return(l==null?void 0:l.ruleName)||e},De=t=>{const e=Array.isArray(t)?t.filter(Boolean):[];if(e.length===0)return"-";const l=e.map(d=>Re(d)),i=l.slice(0,2).join(" / ");return l.length<=2?i:`${i} +${l.length-2}`},Pe=t=>{const e=String((t==null?void 0:t.taskType)||"");if(e==="SCAN"){const l=String((t==null?void 0:t.taskKind)||"");if(l)return D(l);const i=ke(t==null?void 0:t.paramsJson);return D(i.scanKind)||"-"}if(e==="ASSESS"){const l=ke(t==null?void 0:t.paramsJson);return De(l.assessRuleCodes)}return e==="ALARM"?"告警":"-"},q=t=>{const e=String(t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),l=[],i=new Set;for(const d of e.split(`
`)){const f=String(d||"").trim();!f||f.startsWith("#")||i.has(f)||(i.add(f),l.push(f))}return l},Fe=()=>{if(r.form.taskType==="SCAN"){const t={scanKind:o.kind};return o.kind==="PORT"?(t.ips=q(o.ip),t.range=o.range,t.timeoutSec=Number(o.timeoutSec),t.concurrency=Number(o.concurrency),o.range==="CUSTOM"&&(t.portSpec=String(o.portsText||"").trim())):o.kind==="DNS"?t.domains=q(o.domain):o.kind==="CRT"?t.domain=String(o.domain||"").trim():o.kind==="FOFA"&&(t.query=String(o.query||"").trim(),t.maxSize=o.maxSize),JSON.stringify(t)}if(r.form.taskType==="ASSESS"){const t=Array.isArray(w.ruleCodes)?w.ruleCodes.filter(Boolean):[];return JSON.stringify({assetCodes:w.assetCodes||[],assessRuleCodes:t})}return r.form.paramsJson||""},ae=()=>{if(r.form.taskType==="SCAN"){let t={};try{t=r.form.paramsJson?JSON.parse(r.form.paramsJson):{}}catch{t={}}o.kind=t.scanKind||"",o.ip=o.kind==="PORT"&&Array.isArray(t.ips)?t.ips.filter(Boolean).join(`
`):"",o.kind==="DNS"?o.domain=Array.isArray(t.domains)?t.domains.filter(Boolean).join(`
`):"":o.kind==="CRT"?o.domain=t.domain||"":o.domain="",o.query=o.kind==="FOFA"&&t.query||"",o.maxSize=t.maxSize||100,o.range=t.range||"COMMON",o.timeoutSec=t.timeoutSec||10,o.concurrency=t.concurrency||100,o.portsText=t.portSpec||""}if(r.form.taskType==="ASSESS"){let t={};try{t=r.form.paramsJson?JSON.parse(r.form.paramsJson):{}}catch{t={}}w.assetCodes=Array.isArray(t.assetCodes)?t.assetCodes:[],w.ruleCodes=Array.isArray(t.assessRuleCodes)&&t.assessRuleCodes.length?t.assessRuleCodes:["HIGH_RISK_PORT_OPEN","ADMIN_PATH_EXPOSED","SENSITIVE_PATH_EXPOSED","FRAMEWORK_FINGERPRINT_EXPOSED"]}},Me=()=>{ae(),r.form.taskType==="SCAN"&&(V.value=1)},Ue=(t,e)=>{const l=String(e||"").trim(),i=String(t||"").toUpperCase(),d=i.startsWith("WEEKLY_")?i.slice(7):"",f=i.startsWith("MONTHLY_")?i.slice(8):"";if(i==="WEEKLY"||i.startsWith("WEEKLY_")){const u=l.match(/^(MON|TUE|WED|THU|FRI|SAT|SUN)\s+(\d{2}:\d{2})$/);return u?{weeklyDow:u[1],monthlyDom:1,time:u[2]}:l.match(/^\d{2}:\d{2}$/)?{weeklyDow:d||"MON",monthlyDom:1,time:l}:{weeklyDow:d||"MON",monthlyDom:1,time:"02:00"}}if(i==="MONTHLY"||i.startsWith("MONTHLY_")){const u=l.match(/^(\d{1,2})\s+(\d{2}:\d{2})$/);if(u)return{weeklyDow:"MON",monthlyDom:Math.min(31,Math.max(1,parseInt(u[1],10)||1)),time:u[2]};const v=Math.min(31,Math.max(1,parseInt(f,10)||1));return l.match(/^\d{2}:\d{2}$/)?{weeklyDow:"MON",monthlyDom:v,time:l}:{weeklyDow:"MON",monthlyDom:v,time:"02:00"}}return{weeklyDow:"MON",monthlyDom:1,time:l||"02:00"}},Ie=()=>{const t=String(r.form.scheduleFrequency||"").toUpperCase(),e=String(S.time||"").trim();return t==="WEEKLY"?{scheduleFrequency:`WEEKLY_${S.weeklyDow}`,scheduleTime:e}:t==="MONTHLY"?{scheduleFrequency:`MONTHLY_${S.monthlyDom}`,scheduleTime:e}:{scheduleFrequency:t,scheduleTime:e}},Se=(t,e)=>{const l=String(t||"").toUpperCase(),i=String(e||"").trim();if(l==="WEEKLY"||l.startsWith("WEEKLY_")){const d=i.match(/^(MON|TUE|WED|THU|FRI|SAT|SUN)\s+(\d{2}:\d{2})$/),f=d?d[1]:l.startsWith("WEEKLY_")?l.slice(7):"MON",u=d?d[2]:i;return`${{MON:"周一",TUE:"周二",WED:"周三",THU:"周四",FRI:"周五",SAT:"周六",SUN:"周日"}[f]||f} ${u}`}if(l==="MONTHLY"||l.startsWith("MONTHLY_")){const d=i.match(/^(\d{1,2})\s+(\d{2}:\d{2})$/);return d?`${d[1]}号 ${d[2]}`:`${l.startsWith("MONTHLY_")&&parseInt(l.slice(8),10)||1}号 ${i}`}return i},Le=J(()=>{const t=String(r.form.scheduleFrequency||"").toUpperCase();return t==="WEEKLY"?`每周 ${Se(`WEEKLY_${S.weeklyDow}`,S.time)} 执行`:t==="MONTHLY"?`每月 ${S.monthlyDom} 号 ${S.time} 执行（当月无该日期将取月末）`:t==="ONCE"?`一次性：在 ${S.time} 执行（若已过期则立即排队）`:`每日 ${S.time} 执行`}),ze=()=>{r.mode="create",r.taskCode="",r.form={taskType:M.fixedType||"SCAN",taskKind:null,taskName:"",enabled:0,scheduleFrequency:"ONCE",scheduleTime:"",paramsJson:M.defaultParamsJson},S.time="02:00",S.weeklyDow="MON",S.monthlyDom=1,ae(),o.ip="",V.value=(r.form.taskType==="SCAN",1),r.visible=!0},He=t=>{r.mode="edit",r.taskCode=t.taskCode;const e=String(t.scheduleFrequency||"").toUpperCase(),l=e.startsWith("WEEKLY")?"WEEKLY":e.startsWith("MONTHLY")?"MONTHLY":t.scheduleFrequency;r.form={taskType:t.taskType,taskKind:t.taskKind||null,taskName:t.taskName,enabled:t.enabled,scheduleFrequency:l,scheduleTime:t.scheduleTime,paramsJson:t.paramsJson||""};const i=Ue(t.scheduleFrequency,r.form.scheduleTime);S.time=i.time,S.weeklyDow=i.weeklyDow,S.monthlyDom=i.monthlyDom,ae(),V.value=r.form.taskType==="SCAN"?2:1,r.visible=!0},qe=async()=>{var t,e,l,i;r.loading=!0;try{if(await((e=(t=pe.value)==null?void 0:t.validate)==null?void 0:e.call(t)),!String(S.time||"").trim().match(/^(?:[01]\d|2[0-3]):[0-5]\d$/)){C.error("时间点格式错误，应为 HH:mm");return}if(r.form.taskType==="SCAN"&&!o.kind){C.error("请选择扫描模块");return}if(r.form.taskType==="SCAN"&&o.kind==="PORT"){if(q(o.ip).length===0){C.error("请填写 IPv4 地址");return}if(o.range==="CUSTOM"&&!String(o.portsText||"").trim()){C.error("请填写自定义端口");return}}if(r.form.taskType==="SCAN"&&o.kind==="DNS"&&q(o.domain).length===0){C.error("请填写域名");return}if(r.form.taskType==="SCAN"&&o.kind==="CRT"){const v=String(o.domain||"").trim();if(!v){C.error("请填写域名");return}if(/[\r\n]/.test(v)){C.error("CRT 仅支持单域名，不支持批量");return}}if(r.form.taskType==="SCAN"&&o.kind==="FOFA"){const v=String(o.query||"").trim();if(!v){C.error("请填写 FOFA 查询语句");return}if(/[\r\n]/.test(v)){C.error("FOFA 仅支持单条 query，不支持批量");return}}if(r.form.taskType==="SCAN"&&V.value<2){C.error("请点击下一步配置参数");return}if(r.form.taskType==="ASSESS"&&(!Array.isArray(w.ruleCodes)||w.ruleCodes.length===0)){C.error("请至少选择一个评估项");return}const f=Ie(),u={...r.form,paramsJson:Fe(),scheduleFrequency:f.scheduleFrequency,scheduleTime:f.scheduleTime};u.taskType==="SCAN"?u.taskKind=o.kind:u.taskType==="ASSESS"?u.taskKind=null:u.taskType==="ALARM"?u.taskKind="ALARM":u.taskKind=u.taskKind||"",r.mode==="create"?await E.post("/api/tasks",u):await E.put(`/api/tasks/${encodeURIComponent(r.taskCode)}`,u),C.success("保存成功"),r.visible=!1,await R()}catch(d){C.error(((i=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:i.message)||"保存失败")}finally{r.loading=!1}},Ke=async t=>{var e,l,i;try{const{data:d}=await E.post(`/api/tasks/${encodeURIComponent(t.taskCode)}/run`);C.success(((e=d==null?void 0:d.data)==null?void 0:e.summary)||"已执行"),await R()}catch(d){C.error(((i=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:i.message)||"执行失败")}},$e=async t=>{var e,l;if(t!=null&&t.taskCode){try{await be.confirm(`确认删除任务 ${t.taskCode}？`,"删除确认",{type:"warning"})}catch{return}try{await E.delete(`/api/tasks/${encodeURIComponent(t.taskCode)}`),C.success("已删除"),O.value.delete(t.taskCode),await R(),X(le)}catch(i){C.error(((l=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:l.message)||"删除失败")}}},We=async()=>{var e,l;const t=Array.from(O.value);if(t.length!==0){try{await be.confirm(`确认删除选中的 ${t.length} 个任务？`,"删除确认",{type:"warning"})}catch{return}try{await E.post("/api/tasks/batch-delete",{taskCodes:t}),C.success("已删除"),O.value=new Set,await R(),X(le)}catch(i){C.error(((l=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:l.message)||"删除失败")}}},Ye=async t=>{const e=(t==null?void 0:t.taskType)||M.fixedType||"";if(e==="SCAN"){de.push({path:"/scan/history",query:{taskCode:t.taskCode}});return}if(e==="ASSESS"){de.push({path:"/assess/history",query:{taskCode:t.taskCode}});return}const{data:l}=await E.get(`/api/tasks/${encodeURIComponent(t.taskCode)}/history`);U.rows=(l==null?void 0:l.data)||[],U.visible=!0},Je=t=>t==="SUCCESS"?"success":t==="FAILED"?"danger":t==="RUNNING"?"warning":"info",Be=t=>{const e=String(t||"").toUpperCase();return e.startsWith("WEEKLY")?"每周":e.startsWith("MONTHLY")?"每月":e==="ONCE"?"一次性":e==="DAILY"?"每日":t||"未知"},Xe=t=>{const e=Q.value.find(l=>l.itemCode===t);return(e==null?void 0:e.itemName)||t||"未知"},Ge=J(()=>Array.from(F.value).length),je=async()=>{c.assetType="",c.importance="",c.keyword="",c.page=1,F.value=new Set(w.assetCodes||[]),c.visible=!0,await se(!0)},Qe=()=>{se(!1)},Ze=t=>{const e=new Set(H.value.map(i=>i.assetCode)),l=new Set(F.value);for(const i of e)l.delete(i);for(const i of t||[])i!=null&&i.assetCode&&l.add(i.assetCode);F.value=l},et=()=>{const t=fe.value;if(t)try{t.clearSelection();for(const e of H.value)F.value.has(e.assetCode)&&t.toggleRowSelection(e,!0)}catch{}};mt(()=>[c.visible,c.keyword,c.assetType,c.importance],async([t],[e]=[])=>{t&&e&&await se(!0)});const tt=()=>{w.assetCodes=Array.from(F.value),c.visible=!1};return I(R),I(async()=>{try{Q.value=await G("TASK_STATUS")}catch{Q.value=[{itemCode:"RUNNING",itemName:"运行中"},{itemCode:"SUCCESS",itemName:"成功"},{itemCode:"FAILED",itemName:"失败"}]}}),I(async()=>{try{ee.value=await G("CLAIM_DISCOVERED_TYPE")}catch{ee.value=[{itemCode:"PORT",itemName:"端口扫描"},{itemCode:"DNS",itemName:"DNS爆破"},{itemCode:"CRT",itemName:"CT查询"},{itemCode:"FOFA",itemName:"网络空间搜索"}]}}),I(async()=>{try{const{data:t}=await E.get("/api/assess/config/rules");te.value=(t==null?void 0:t.data)||[]}catch{te.value=[{ruleCode:"HIGH_RISK_PORT_OPEN",ruleName:"高危端口暴露"},{ruleCode:"ADMIN_PATH_EXPOSED",ruleName:"管理路径暴露"},{ruleCode:"SENSITIVE_PATH_EXPOSED",ruleName:"敏感路径暴露"},{ruleCode:"FRAMEWORK_FINGERPRINT_EXPOSED",ruleName:"框架指纹暴露"}]}}),I(async()=>{try{z.value=await G("ASSET_TYPE")}catch{z.value=[{itemCode:"WEB_APP",itemName:"Web 应用"},{itemCode:"API",itemName:"API 接口"},{itemCode:"DOMAIN",itemName:"域名"},{itemCode:"IP",itemName:"IP"},{itemCode:"DB",itemName:"数据库"},{itemCode:"OTHER",itemName:"其他"}]}try{Z.value=await G("ASSET_IMPORTANCE")}catch{Z.value=[{itemCode:"核心业务",itemName:"核心业务"},{itemCode:"重要业务",itemName:"重要业务"},{itemCode:"一般业务",itemName:"一般业务"},{itemCode:"辅助业务",itemName:"辅助业务"}]}}),(t,e)=>{const l=k("el-option"),i=k("el-select"),d=k("el-input"),f=k("el-button"),u=k("el-table-column"),v=k("el-tag"),oe=k("el-table"),ve=k("el-pagination"),A=k("el-form-item"),st=k("el-switch"),K=k("el-input-number"),lt=k("el-time-picker"),at=k("el-divider"),$=k("el-checkbox"),ot=k("el-checkbox-group"),Ce=k("el-step"),nt=k("el-steps"),W=k("el-card"),Y=k("el-col"),it=k("el-row"),ge=k("el-collapse-item"),Te=k("el-collapse"),rt=k("el-form"),ne=k("el-dialog");return y(),h(re,null,[m("div",ct,[m("div",ft,[s(i,{modelValue:b.taskType,"onUpdate:modelValue":e[0]||(e[0]=a=>b.taskType=a),placeholder:"任务模块",clearable:"",style:{width:"170px"},disabled:!!j.value},{default:n(()=>[s(l,{label:"扫描任务",value:"SCAN"}),s(l,{label:"评估任务",value:"ASSESS"}),s(l,{label:"告警任务",value:"ALARM"})]),_:1},8,["modelValue","disabled"]),s(i,{modelValue:b.enabled,"onUpdate:modelValue":e[1]||(e[1]=a=>b.enabled=a),placeholder:"启用状态",clearable:"",style:{width:"170px"}},{default:n(()=>[s(l,{label:"启用",value:1}),s(l,{label:"停用",value:0})]),_:1},8,["modelValue"]),s(d,{modelValue:b.keyword,"onUpdate:modelValue":e[2]||(e[2]=a=>b.keyword=a),placeholder:"任务名称关键词",style:{width:"240px"},clearable:"",onKeyup:pt(ye,["enter"])},null,8,["modelValue"]),s(f,{onClick:ye},{default:n(()=>[...e[40]||(e[40]=[p("查询",-1)])]),_:1}),s(f,{type:"danger",plain:"",disabled:he.value===0,onClick:We},{default:n(()=>[...e[41]||(e[41]=[p("批量删除",-1)])]),_:1},8,["disabled"]),e[43]||(e[43]=m("div",{class:"spacer"},null,-1)),s(f,{type:"primary",onClick:ze},{default:n(()=>[...e[42]||(e[42]=[p("新建任务",-1)])]),_:1})]),m("div",yt,[s(oe,{ref_key:"taskTableRef",ref:me,data:L.value,height:"100%",border:"","row-key":"taskCode","reserve-selection":!0,onSelectionChange:Oe},{default:n(()=>[s(u,{type:"selection",width:"46"}),s(u,{prop:"taskCode",label:"任务编码",width:"240","show-overflow-tooltip":""}),s(u,{prop:"taskType",label:"模块",width:"90"},{default:n(({row:a})=>[s(v,{size:"small",effect:"plain"},{default:n(()=>[p(g(Ve(a)),1)]),_:2},1024)]),_:1}),s(u,{prop:"taskKind",label:"模块项",width:"220","show-overflow-tooltip":""},{default:n(({row:a})=>[s(v,{size:"small",effect:"plain"},{default:n(()=>[p(g(Pe(a)),1)]),_:2},1024)]),_:1}),s(u,{prop:"taskName",label:"名称","min-width":"220","show-overflow-tooltip":""}),s(u,{prop:"enabled",label:"启用",width:"90"},{default:n(({row:a})=>[s(v,{size:"small",type:a.enabled===1?"success":"info"},{default:n(()=>[p(g(a.enabled===1?"启用":"停用"),1)]),_:2},1032,["type"])]),_:1}),s(u,{prop:"scheduleFrequency",label:"频率",width:"110"},{default:n(({row:a})=>[s(v,{size:"small",effect:"plain"},{default:n(()=>[p(g(Be(a.scheduleFrequency)),1)]),_:2},1024)]),_:1}),s(u,{prop:"scheduleTime",label:"时间",width:"120"},{default:n(({row:a})=>[m("span",null,g(Se(a.scheduleFrequency,a.scheduleTime)),1)]),_:1}),s(u,{prop:"nextRunAt",label:"下次执行",width:"170"}),s(u,{prop:"lastStatus",label:"上次状态",width:"120"},{default:n(({row:a})=>[a.lastStatus?(y(),T(v,{key:0,size:"small",type:Je(a.lastStatus)},{default:n(()=>[p(g(Xe(a.lastStatus)),1)]),_:2},1032,["type"])):_("",!0)]),_:1}),s(u,{prop:"lastSummary",label:"上次摘要","min-width":"240","show-overflow-tooltip":""}),s(u,{label:"操作",width:"260",fixed:"right"},{default:n(({row:a})=>[s(f,{size:"small",onClick:ie=>He(a)},{default:n(()=>[...e[44]||(e[44]=[p("编辑",-1)])]),_:1},8,["onClick"]),s(f,{size:"small",type:"primary",plain:"",onClick:ie=>Ke(a)},{default:n(()=>[...e[45]||(e[45]=[p("执行",-1)])]),_:1},8,["onClick"]),s(f,{size:"small",onClick:ie=>Ye(a)},{default:n(()=>[...e[46]||(e[46]=[p("历史",-1)])]),_:1},8,["onClick"]),s(f,{size:"small",type:"danger",plain:"",onClick:ie=>$e(a)},{default:n(()=>[...e[47]||(e[47]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),m("div",kt,[s(ve,{class:"en-pagination",layout:"total, sizes, prev, pager, next",total:ue.value,"page-sizes":[20,50,100],"page-size":x.size,"current-page":x.current,"onUpdate:currentPage":e[3]||(e[3]=a=>x.current=a),onSizeChange:Ee,onCurrentChange:xe},null,8,["total","page-size","current-page"])])]),s(ne,{modelValue:r.visible,"onUpdate:modelValue":e[32]||(e[32]=a=>r.visible=a),title:r.mode==="create"?"新建任务":"编辑任务",width:"820px",class:"en-task-dialog"},{footer:n(()=>[s(f,{onClick:e[31]||(e[31]=a=>r.visible=!1)},{default:n(()=>[...e[74]||(e[74]=[p("取消",-1)])]),_:1}),s(f,{type:"primary",loading:r.loading,onClick:qe},{default:n(()=>[...e[75]||(e[75]=[p("保存",-1)])]),_:1},8,["loading"])]),default:n(()=>[s(rt,{ref_key:"formRef",ref:pe,model:r.form,rules:Ae,"label-width":"96px"},{default:n(()=>[r.mode==="create"&&!j.value?(y(),T(A,{key:0,label:"任务模块"},{default:n(()=>[s(i,{modelValue:r.form.taskType,"onUpdate:modelValue":e[4]||(e[4]=a=>r.form.taskType=a),style:{width:"100%"},disabled:!!j.value,onChange:Me},{default:n(()=>[s(l,{label:"扫描任务",value:"SCAN"}),s(l,{label:"评估任务",value:"ASSESS"}),s(l,{label:"告警任务",value:"ALARM"})]),_:1},8,["modelValue","disabled"])]),_:1})):_("",!0),s(A,{label:"任务名称",prop:"taskName",required:""},{default:n(()=>[s(d,{modelValue:r.form.taskName,"onUpdate:modelValue":e[5]||(e[5]=a=>r.form.taskName=a),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),s(A,{label:"启用状态"},{default:n(()=>[s(st,{modelValue:r.form.enabled,"onUpdate:modelValue":e[6]||(e[6]=a=>r.form.enabled=a),"active-value":1,"inactive-value":0},null,8,["modelValue"]),e[48]||(e[48]=m("div",{class:"en-muted",style:{"font-size":"12px","margin-left":"10px"}}," 默认不启用：停用时不会自动定时执行，可在任务列表点击“执行”手动触发；启用后按频率自动执行。 ",-1))]),_:1}),s(A,{label:"执行频率",prop:"scheduleFrequency",required:""},{default:n(()=>[s(i,{modelValue:r.form.scheduleFrequency,"onUpdate:modelValue":e[7]||(e[7]=a=>r.form.scheduleFrequency=a),style:{width:"100%"}},{default:n(()=>[s(l,{label:"一次性",value:"ONCE"}),s(l,{label:"每日",value:"DAILY"}),s(l,{label:"每周",value:"WEEKLY"}),s(l,{label:"每月",value:"MONTHLY"})]),_:1},8,["modelValue"])]),_:1}),s(A,{label:"执行时间",required:""},{default:n(()=>[m("div",St,[r.form.scheduleFrequency==="WEEKLY"?(y(),T(i,{key:0,modelValue:S.weeklyDow,"onUpdate:modelValue":e[8]||(e[8]=a=>S.weeklyDow=a),style:{width:"140px"}},{default:n(()=>[s(l,{label:"周一",value:"MON"}),s(l,{label:"周二",value:"TUE"}),s(l,{label:"周三",value:"WED"}),s(l,{label:"周四",value:"THU"}),s(l,{label:"周五",value:"FRI"}),s(l,{label:"周六",value:"SAT"}),s(l,{label:"周日",value:"SUN"})]),_:1},8,["modelValue"])):_("",!0),r.form.scheduleFrequency==="MONTHLY"?(y(),T(K,{key:1,modelValue:S.monthlyDom,"onUpdate:modelValue":e[9]||(e[9]=a=>S.monthlyDom=a),min:1,max:31,"controls-position":"right",style:{width:"140px"}},null,8,["modelValue"])):_("",!0),s(lt,{modelValue:S.time,"onUpdate:modelValue":e[10]||(e[10]=a=>S.time=a),format:"HH:mm","value-format":"HH:mm",placeholder:"选择时间","popper-class":"en-time-picker-popper",style:{width:"140px"}},null,8,["modelValue"]),m("div",vt,g(Le.value),1)])]),_:1}),s(at,{"content-position":"left"},{default:n(()=>[...e[49]||(e[49]=[p("参数",-1)])]),_:1}),r.form.taskType==="SCAN"?(y(),T(A,{key:1,label:"扫描模块",required:""},{default:n(()=>[m("div",Ct,[s(v,{size:"small",effect:"plain"},{default:n(()=>[p(g(D(o.kind)||"请选择"),1)]),_:1})])]),_:1})):_("",!0),r.form.taskType==="ASSESS"?(y(),T(A,{key:2,label:"评估模块",required:""},{default:n(()=>[m("div",gt,[m("div",Tt,[s(ot,{modelValue:w.ruleCodes,"onUpdate:modelValue":e[11]||(e[11]=a=>w.ruleCodes=a),class:"en-assess-rule-group"},{default:n(()=>[s($,{label:"HIGH_RISK_PORT_OPEN",style:{"white-space":"nowrap"}},{default:n(()=>[...e[50]||(e[50]=[p("高危端口",-1)])]),_:1}),s($,{label:"ADMIN_PATH_EXPOSED",style:{"white-space":"nowrap"}},{default:n(()=>[...e[51]||(e[51]=[p("管理路径",-1)])]),_:1}),s($,{label:"SENSITIVE_PATH_EXPOSED",style:{"white-space":"nowrap"}},{default:n(()=>[...e[52]||(e[52]=[p("敏感路径",-1)])]),_:1}),s($,{label:"FRAMEWORK_FINGERPRINT_EXPOSED",style:{"white-space":"nowrap"}},{default:n(()=>[...e[53]||(e[53]=[p("框架指纹",-1)])]),_:1})]),_:1},8,["modelValue"]),e[54]||(e[54]=m("span",{class:"en-muted en-assess-hint"},"可多选",-1))])])]),_:1})):_("",!0),r.form.taskType==="SCAN"?(y(),T(A,{key:3,label:"参数设置"},{default:n(()=>[m("div",Nt,[s(nt,{active:V.value-1,"finish-status":"success"},{default:n(()=>[s(Ce,{title:"选择模块"}),s(Ce,{title:"配置参数"})]),_:1},8,["active"]),V.value===1?(y(),h("div",bt,[m("div",wt,[s(W,{shadow:"never",class:B(o.kind==="PORT"?"en-choice is-active":"en-choice"),onClick:e[12]||(e[12]=a=>o.kind="PORT")},{default:n(()=>[m("div",ht,[e[55]||(e[55]=m("span",{class:"en-choice-dot en-dot-port"},null,-1)),p(" "+g(D("PORT")||"端口扫描"),1)]),e[56]||(e[56]=m("div",{class:"en-choice-desc"},"输入 IPv4，探测开放端口",-1))]),_:1},8,["class"]),s(W,{shadow:"never",class:B(o.kind==="DNS"?"en-choice is-active":"en-choice"),onClick:e[13]||(e[13]=a=>o.kind="DNS")},{default:n(()=>[m("div",_t,[e[57]||(e[57]=m("span",{class:"en-choice-dot en-dot-dns"},null,-1)),p(" "+g(D("DNS")||"DNS爆破"),1)]),e[58]||(e[58]=m("div",{class:"en-choice-desc"},"基于子域名字典进行发现",-1))]),_:1},8,["class"]),s(W,{shadow:"never",class:B(o.kind==="CRT"?"en-choice is-active":"en-choice"),onClick:e[14]||(e[14]=a=>o.kind="CRT")},{default:n(()=>[m("div",At,[e[59]||(e[59]=m("span",{class:"en-choice-dot en-dot-crt"},null,-1)),p(" "+g(D("CRT")||"CT查询"),1)]),e[60]||(e[60]=m("div",{class:"en-choice-desc"},"crt.sh 查询域名相关子域名",-1))]),_:1},8,["class"]),s(W,{shadow:"never",class:B(o.kind==="FOFA"?"en-choice is-active":"en-choice"),onClick:e[15]||(e[15]=a=>o.kind="FOFA")},{default:n(()=>[m("div",Et,[e[61]||(e[61]=m("span",{class:"en-choice-dot en-dot-fofa"},null,-1)),p(" "+g(D("FOFA")||"网络空间搜索"),1)]),e[62]||(e[62]=m("div",{class:"en-choice-desc"},"FOFA 查询（需在扫描配置中启用）",-1))]),_:1},8,["class"])]),m("div",xt,[s(f,{type:"primary",onClick:e[16]||(e[16]=a=>V.value=2)},{default:n(()=>[...e[63]||(e[63]=[p("下一步",-1)])]),_:1})])])):(y(),h("div",Ot,[m("div",Vt,[s(v,{size:"small",effect:"plain"},{default:n(()=>[p("扫描模块："+g(D(o.kind)||o.kind||"-"),1)]),_:1}),s(f,{size:"small",type:"primary",onClick:e[17]||(e[17]=a=>V.value=1)},{default:n(()=>[...e[64]||(e[64]=[p("返回选择",-1)])]),_:1})]),s(it,{gutter:8,style:{"margin-top":"8px"}},{default:n(()=>[o.kind==="PORT"?(y(),T(Y,{key:0,span:24},{default:n(()=>[s(d,{modelValue:o.ip,"onUpdate:modelValue":e[18]||(e[18]=a=>o.ip=a),type:"textarea",rows:6,placeholder:"每行一个 IPv4，例如 1.1.1.1"},null,8,["modelValue"])]),_:1})):o.kind==="DNS"?(y(),T(Y,{key:1,span:24},{default:n(()=>[s(d,{modelValue:o.domain,"onUpdate:modelValue":e[19]||(e[19]=a=>o.domain=a),type:"textarea",rows:6,placeholder:"每行一个域名，例如 example.com"},null,8,["modelValue"])]),_:1})):o.kind==="CRT"?(y(),T(Y,{key:2,span:24},{default:n(()=>[s(d,{modelValue:o.domain,"onUpdate:modelValue":e[20]||(e[20]=a=>o.domain=a),placeholder:"域名，例如 example.com"},null,8,["modelValue"])]),_:1})):(y(),T(Y,{key:3,span:24},{default:n(()=>[s(d,{modelValue:o.query,"onUpdate:modelValue":e[21]||(e[21]=a=>o.query=a),placeholder:"单条 FOFA 查询语句，例如 domain=example.com"},null,8,["modelValue"])]),_:1}))]),_:1}),o.kind==="PORT"||o.kind==="DNS"?(y(),h("div",Rt," 支持批量输入：每行一个，空行与以 # 开头的行会忽略 ")):o.kind==="CRT"?(y(),h("div",Dt,"仅支持单域名，不支持批量")):o.kind==="FOFA"?(y(),h("div",Pt,"仅支持单条 query，不支持批量")):_("",!0),o.kind==="PORT"?(y(),h("div",Ft,[s(i,{modelValue:o.range,"onUpdate:modelValue":e[22]||(e[22]=a=>o.range=a),style:{width:"170px"}},{default:n(()=>[s(l,{label:"全端口",value:"ALL"}),s(l,{label:"常用端口(字典)",value:"COMMON"}),s(l,{label:"自定义端口",value:"CUSTOM"})]),_:1},8,["modelValue"]),o.range==="CUSTOM"?(y(),T(d,{key:0,modelValue:o.portsText,"onUpdate:modelValue":e[23]||(e[23]=a=>o.portsText=a),placeholder:"例如 22-25,80,443"},null,8,["modelValue"])):_("",!0)])):_("",!0),o.kind==="PORT"?(y(),h("div",Mt,[s(K,{modelValue:o.timeoutSec,"onUpdate:modelValue":e[24]||(e[24]=a=>o.timeoutSec=a),min:1,max:60,"controls-position":"right"},null,8,["modelValue"]),e[65]||(e[65]=m("span",{class:"en-task-mono"},"超时(s)",-1)),e[66]||(e[66]=m("span",{class:"en-task-k"},"timeoutSec",-1)),s(K,{modelValue:o.concurrency,"onUpdate:modelValue":e[25]||(e[25]=a=>o.concurrency=a),min:1,max:800,"controls-position":"right"},null,8,["modelValue"]),e[67]||(e[67]=m("span",{class:"en-task-mono"},"并发数",-1)),e[68]||(e[68]=m("span",{class:"en-task-k"},"concurrency",-1))])):_("",!0),o.kind==="FOFA"?(y(),h("div",Ut,[s(K,{modelValue:o.maxSize,"onUpdate:modelValue":e[26]||(e[26]=a=>o.maxSize=a),min:1,max:9999,"controls-position":"right"},null,8,["modelValue"]),e[69]||(e[69]=m("span",{class:"en-task-mono"},"最大数量",-1)),e[70]||(e[70]=m("span",{class:"en-task-k"},"maxSize",-1))])):_("",!0),s(Te,{style:{"margin-top":"10px"}},{default:n(()=>[s(ge,{title:"高级：直接编辑 JSON"},{default:n(()=>[s(d,{modelValue:r.form.paramsJson,"onUpdate:modelValue":e[27]||(e[27]=a=>r.form.paramsJson=a),type:"textarea",rows:6,placeholder:"高级用户可直接编辑 paramsJson"},null,8,["modelValue"])]),_:1})]),_:1})]))])]),_:1})):r.form.taskType==="ASSESS"?(y(),T(A,{key:4,label:"参数设置"},{default:n(()=>[m("div",It,[m("div",Lt,[s(f,{onClick:je},{default:n(()=>[...e[71]||(e[71]=[p("选择资产",-1)])]),_:1}),s(v,{size:"small",effect:"plain"},{default:n(()=>[p(g((w.assetCodes||[]).length)+" 已选",1)]),_:1}),s(f,{text:"",onClick:e[28]||(e[28]=a=>w.assetCodes=[])},{default:n(()=>[...e[72]||(e[72]=[p("清空",-1)])]),_:1})]),e[73]||(e[73]=m("div",{class:"en-muted",style:{"font-size":"12px","margin-top":"6px"}},"留空表示评估全部资产",-1)),s(Te,{style:{"margin-top":"10px"}},{default:n(()=>[s(ge,{title:"高级：直接编辑 JSON"},{default:n(()=>[s(d,{modelValue:r.form.paramsJson,"onUpdate:modelValue":e[29]||(e[29]=a=>r.form.paramsJson=a),type:"textarea",rows:6,placeholder:"例如：{assetCodes:[ASSET-...]}"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1})):(y(),T(A,{key:5,label:"参数(JSON)"},{default:n(()=>[s(d,{modelValue:r.form.paramsJson,"onUpdate:modelValue":e[30]||(e[30]=a=>r.form.paramsJson=a),type:"textarea",rows:6,placeholder:"可留空"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),s(ne,{modelValue:U.visible,"onUpdate:modelValue":e[33]||(e[33]=a=>U.visible=a),title:"执行历史",width:"760px"},{default:n(()=>[s(oe,{data:U.rows,height:"440px",border:""},{default:n(()=>[s(u,{prop:"startedAt",label:"开始",width:"170"}),s(u,{prop:"finishedAt",label:"结束",width:"170"}),s(u,{prop:"status",label:"状态",width:"110"}),s(u,{prop:"summary",label:"摘要","min-width":"240","show-overflow-tooltip":""}),s(u,{prop:"detailJson",label:"详情","min-width":"260","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["modelValue"]),s(ne,{modelValue:c.visible,"onUpdate:modelValue":e[39]||(e[39]=a=>c.visible=a),title:"选择资产",width:"980px"},{footer:n(()=>[s(f,{onClick:e[38]||(e[38]=a=>c.visible=!1)},{default:n(()=>[...e[77]||(e[77]=[p("取消",-1)])]),_:1}),s(f,{type:"primary",onClick:tt},{default:n(()=>[...e[78]||(e[78]=[p("确认",-1)])]),_:1})]),default:n(()=>[m("div",zt,[s(i,{modelValue:c.assetType,"onUpdate:modelValue":e[34]||(e[34]=a=>c.assetType=a),placeholder:"资产类型",clearable:"",style:{width:"180px"}},{default:n(()=>[(y(!0),h(re,null,Ne(z.value,a=>(y(),T(l,{key:a.itemCode,label:a.itemName,value:a.itemCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(i,{modelValue:c.importance,"onUpdate:modelValue":e[35]||(e[35]=a=>c.importance=a),placeholder:"业务重要性",clearable:"",style:{width:"180px"}},{default:n(()=>[(y(!0),h(re,null,Ne(Z.value,a=>(y(),T(l,{key:a.itemCode,label:a.itemName,value:a.itemCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(d,{modelValue:c.keyword,"onUpdate:modelValue":e[36]||(e[36]=a=>c.keyword=a),placeholder:"搜索 名称/地址/编号",clearable:"",style:{width:"260px"}},null,8,["modelValue"]),e[76]||(e[76]=m("div",{class:"spacer"},null,-1)),s(v,{size:"small",effect:"plain"},{default:n(()=>[p(g(Ge.value)+" 已选",1)]),_:1})]),m("div",Ht,[s(oe,{ref_key:"assetTableRef",ref:fe,data:H.value,height:"100%",border:"","row-key":"assetCode","reserve-selection":!0,onSelectionChange:Ze},{default:n(()=>[s(u,{type:"selection",width:"46"}),s(u,{prop:"assetCode",label:"编号",width:"240","show-overflow-tooltip":""}),s(u,{prop:"assetName",label:"名称",width:"180","show-overflow-tooltip":""}),s(u,{prop:"assetType",label:"类型",width:"110"},{default:n(({row:a})=>[m("span",null,g(_e(a==null?void 0:a.assetType)),1)]),_:1}),s(u,{prop:"assetAddress",label:"地址","min-width":"240","show-overflow-tooltip":""})]),_:1},8,["data"])]),m("div",qt,[s(ve,{layout:"total, prev, pager, next",total:ce.value,"page-size":c.pageSize,"current-page":c.page,"onUpdate:currentPage":e[37]||(e[37]=a=>c.page=a),onCurrentChange:Qe},null,8,["total","page-size","current-page"])])]),_:1},8,["modelValue"])],64)}}},Yt=dt(Kt,[["__scopeId","data-v-471d9450"]]);export{Yt as T};
