import{_ as it,y as rt,k as J,a as C,r as P,z as dt,o as M,h as E,f,c as D,g as c,d as u,e as l,w as o,l as ut,j as m,t as v,p as g,v as A,B as Y,F as ie,m as Te,n as W,E as T,x as be}from"./index-8jM1g0LY.js";import{g as X}from"./bizDict-CjwNfxYx.js";const mt={class:"en-page"},pt={class:"en-toolbar"},ft={class:"en-table-wrap"},ct={style:{display:"flex","justify-content":"flex-end",padding:"12px 0 2px"}},yt={style:{display:"flex",gap:"10px",width:"100%","flex-wrap":"wrap"}},kt={class:"en-muted",style:{"font-size":"12px","line-height":"32px"}},St={style:{display:"flex","align-items":"center",gap:"10px","flex-wrap":"wrap"}},vt={style:{width:"100%"}},Ct={class:"en-assess-rules"},gt={class:"en-task-panel en-task-panel--tall"},Tt={key:0,class:"en-task-step"},bt={class:"en-choice-grid"},Nt={class:"en-choice-title"},wt={class:"en-choice-title"},At={class:"en-choice-title"},_t={class:"en-choice-title"},Et={class:"en-task-actions"},xt={key:1,class:"en-task-step"},Vt={class:"en-task-step-head"},Ot={key:0,style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},ht={key:1,style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},Rt={key:2,style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},Pt={class:"en-task-panel"},Dt={style:{display:"flex","align-items":"center",gap:"8px"}},Ut={class:"en-toolbar",style:{padding:"0"}},It={class:"en-table-wrap",style:{"margin-top":"10px"}},Ft={style:{display:"flex","justify-content":"flex-end",padding:"12px 0 2px"}},Mt={__name:"TaskList",props:{fixedType:{type:String,default:""},defaultName:{type:String,default:""},defaultParamsJson:{type:String,default:""}},setup(Ne){const I=Ne,re=rt(),B=J(()=>!!I.fixedType),z=C([]),de=C(0),G=C([]),$=C([]),j=C([]),Q=C([]),Z=C([]),we=J(()=>Array.from(V.value).length),Ae=t=>{const e=String(t||"").trim();if(!e)return"-";const a=$.value.find(r=>String(r.itemCode||"")===e);return(a==null?void 0:a.itemName)||e},b=P({taskType:I.fixedType||"",enabled:void 0,keyword:""}),x=P({current:1,size:20}),ue=C(),V=C(new Set),me=C(),_e={taskName:[{required:!0,message:"任务名称不能为空",trigger:"blur"}],scheduleFrequency:[{required:!0,message:"频率不能为空",trigger:"change"}]},n=P({visible:!1,loading:!1,mode:"create",taskCode:"",form:{}}),y=P({time:"02:00",weeklyDow:"MON",monthlyDom:1}),i=P({kind:"",ip:"",domain:"",query:"",maxSize:100,range:"COMMON",timeoutSec:10,concurrency:100,portsText:""}),O=C(1),N=P({assetCodes:[],ruleCodes:["HIGH_RISK_PORT_OPEN","ADMIN_PATH_EXPOSED","SENSITIVE_PATH_EXPOSED","FRAMEWORK_FINGERPRINT_EXPOSED"]}),L=C([]),pe=C(0),F=P({visible:!1,rows:[]}),fe=C(),p=P({visible:!1,keyword:"",assetType:"",importance:"",page:1,pageSize:8}),U=C(new Set),h=async(t=!1)=>{var r,d;const e={page:x.current,size:x.size};b.taskType&&(e.taskType=b.taskType),(b.enabled===0||b.enabled===1)&&(e.enabled=b.enabled),b.keyword&&(e.keyword=b.keyword);const{data:a}=await E.get("/api/tasks",{params:e});z.value=((r=a==null?void 0:a.data)==null?void 0:r.rows)||[],de.value=((d=a==null?void 0:a.data)==null?void 0:d.total)||0,t&&(V.value=new Set),await W(),te()},ce=async()=>{x.current=1,await h(!0)},ee=async(t=!1)=>{var r,d;t&&(p.page=1);const e={page:p.page,size:p.pageSize};p.assetType&&(e.assetType=p.assetType),p.importance&&(e.importance=p.importance),p.keyword&&(e.keyword=p.keyword);const{data:a}=await E.get("/api/assets",{params:e});L.value=((r=a==null?void 0:a.data)==null?void 0:r.rows)||[],pe.value=((d=a==null?void 0:a.data)==null?void 0:d.total)||0,await W(),Ze()},Ee=t=>{x.size=t,x.current=1,h()},xe=()=>{h()},Ve=t=>{const e=new Set(z.value.map(r=>r.taskCode)),a=new Set(V.value);for(const r of e)a.delete(r);for(const r of t||[])r!=null&&r.taskCode&&a.add(r.taskCode);V.value=a},te=()=>{const t=ue.value;if(t)try{t.clearSelection();for(const e of z.value)V.value.has(e.taskCode)&&t.toggleRowSelection(e,!0)}catch{}},ye=t=>{if(!t)return{};try{const e=JSON.parse(t);return e&&typeof e=="object"?e:{}}catch{return{}}},R=t=>{const e=Q.value.find(a=>a.itemCode===t);return e!=null&&e.itemName?e.itemName:t==="PORT"?"端口扫描":t==="DNS"?"DNS爆破":t==="CRT"?"CT查询":t==="FOFA"?"网络空间搜索":t||""},Oe=t=>{const e=String((t==null?void 0:t.taskType)||"");return e==="SCAN"?"扫描":e==="ASSESS"?"评估":e==="ALARM"?"告警":e||"未知"},he=t=>{const e=String(t||"").trim();if(!e)return"";const a=Z.value.find(r=>r.ruleCode===e);return(a==null?void 0:a.ruleName)||e},Re=t=>{const e=Array.isArray(t)?t.filter(Boolean):[];if(e.length===0)return"-";const a=e.map(d=>he(d)),r=a.slice(0,2).join(" / ");return a.length<=2?r:`${r} +${a.length-2}`},Pe=t=>{const e=String((t==null?void 0:t.taskType)||"");if(e==="SCAN"){const a=String((t==null?void 0:t.taskKind)||"");if(a)return R(a);const r=ye(t==null?void 0:t.paramsJson);return R(r.scanKind)||"-"}if(e==="ASSESS"){const a=ye(t==null?void 0:t.paramsJson);return Re(a.assessRuleCodes)}return e==="ALARM"?"告警":"-"},De=()=>{if(n.form.taskType==="SCAN"){const t={scanKind:i.kind};return i.kind==="PORT"?(t.ip=i.ip,t.range=i.range,t.timeoutSec=Number(i.timeoutSec),t.concurrency=Number(i.concurrency),i.range==="CUSTOM"&&(t.portSpec=String(i.portsText||"").trim())):i.kind==="DNS"||i.kind==="CRT"?t.domain=i.domain:i.kind==="FOFA"&&(t.query=i.query,t.maxSize=i.maxSize),JSON.stringify(t)}if(n.form.taskType==="ASSESS"){const t=Array.isArray(N.ruleCodes)?N.ruleCodes.filter(Boolean):[];return JSON.stringify({assetCodes:N.assetCodes||[],assessRuleCodes:t})}return n.form.paramsJson||""},le=()=>{if(n.form.taskType==="SCAN"){let t={};try{t=n.form.paramsJson?JSON.parse(n.form.paramsJson):{}}catch{t={}}i.kind=t.scanKind||"",i.ip=t.ip||"",i.domain=t.domain||"",i.query=t.query||"",i.maxSize=t.maxSize||100,i.range=t.range||"COMMON",i.timeoutSec=t.timeoutSec||10,i.concurrency=t.concurrency||100,i.portsText=t.portSpec||""}if(n.form.taskType==="ASSESS"){let t={};try{t=n.form.paramsJson?JSON.parse(n.form.paramsJson):{}}catch{t={}}N.assetCodes=Array.isArray(t.assetCodes)?t.assetCodes:[],N.ruleCodes=Array.isArray(t.assessRuleCodes)&&t.assessRuleCodes.length?t.assessRuleCodes:["HIGH_RISK_PORT_OPEN","ADMIN_PATH_EXPOSED","SENSITIVE_PATH_EXPOSED","FRAMEWORK_FINGERPRINT_EXPOSED"]}},Ue=()=>{le(),n.form.taskType==="SCAN"&&(O.value=1)},Ie=(t,e)=>{const a=String(e||"").trim(),r=String(t||"").toUpperCase();if(r==="WEEKLY"){const d=a.match(/^(MON|TUE|WED|THU|FRI|SAT|SUN)\s+(\d{2}:\d{2})$/);if(d)return{weeklyDow:d[1],monthlyDom:1,time:d[2]}}if(r==="MONTHLY"){const d=a.match(/^(\d{1,2})\s+(\d{2}:\d{2})$/);if(d)return{weeklyDow:"MON",monthlyDom:Math.min(31,Math.max(1,parseInt(d[1],10)||1)),time:d[2]}}return{weeklyDow:"MON",monthlyDom:1,time:a||"02:00"}},Fe=()=>{const t=String(n.form.scheduleFrequency||"").toUpperCase(),e=String(y.time||"").trim();return t==="WEEKLY"?`${y.weeklyDow} ${e}`:t==="MONTHLY"?`${y.monthlyDom} ${e}`:e},ke=(t,e)=>{const a=String(t||"").toUpperCase(),r=String(e||"").trim();if(a==="WEEKLY"){const d=r.match(/^(MON|TUE|WED|THU|FRI|SAT|SUN)\s+(\d{2}:\d{2})$/);return d?`${{MON:"周一",TUE:"周二",WED:"周三",THU:"周四",FRI:"周五",SAT:"周六",SUN:"周日"}[d[1]]||d[1]} ${d[2]}`:r}if(a==="MONTHLY"){const d=r.match(/^(\d{1,2})\s+(\d{2}:\d{2})$/);return d?`${d[1]}号 ${d[2]}`:r}return r},Me=J(()=>{const t=String(n.form.scheduleFrequency||"").toUpperCase();return t==="WEEKLY"?`每周 ${ke("WEEKLY",`${y.weeklyDow} ${y.time}`)} 执行`:t==="MONTHLY"?`每月 ${y.monthlyDom} 号 ${y.time} 执行（当月无该日期将取月末）`:t==="ONCE"?`一次性：在 ${y.time} 执行（若已过期则立即排队）`:`每日 ${y.time} 执行`}),ze=()=>{n.mode="create",n.taskCode="",n.form={taskType:I.fixedType||"SCAN",taskKind:null,taskName:"",enabled:0,scheduleFrequency:"ONCE",scheduleTime:"",paramsJson:I.defaultParamsJson},y.time="02:00",y.weeklyDow="MON",y.monthlyDom=1,le(),i.ip="",O.value=(n.form.taskType==="SCAN",1),n.visible=!0},$e=t=>{n.mode="edit",n.taskCode=t.taskCode,n.form={taskType:t.taskType,taskKind:t.taskKind||null,taskName:t.taskName,enabled:t.enabled,scheduleFrequency:t.scheduleFrequency,scheduleTime:t.scheduleTime,paramsJson:t.paramsJson||""};const e=Ie(n.form.scheduleFrequency,n.form.scheduleTime);y.time=e.time,y.weeklyDow=e.weeklyDow,y.monthlyDom=e.monthlyDom,le(),O.value=n.form.taskType==="SCAN"?2:1,n.visible=!0},Le=async()=>{var t,e,a,r;n.loading=!0;try{if(await((e=(t=me.value)==null?void 0:t.validate)==null?void 0:e.call(t)),!String(y.time||"").trim().match(/^(?:[01]\d|2[0-3]):[0-5]\d$/)){T.error("时间点格式错误，应为 HH:mm");return}if(n.form.taskType==="SCAN"&&!i.kind){T.error("请选择扫描模块");return}if(n.form.taskType==="SCAN"&&i.kind==="PORT"){if(!String(i.ip||"").trim()){T.error("请填写 IPv4 地址");return}if(i.range==="CUSTOM"&&!String(i.portsText||"").trim()){T.error("请填写自定义端口");return}}if(n.form.taskType==="SCAN"&&O.value<2){T.error("请点击下一步配置参数");return}if(n.form.taskType==="ASSESS"&&(!Array.isArray(N.ruleCodes)||N.ruleCodes.length===0)){T.error("请至少选择一个评估项");return}n.form.paramsJson=De(),n.form.taskType==="SCAN"?n.form.taskKind=i.kind:n.form.taskType==="ASSESS"?n.form.taskKind=null:n.form.taskType==="ALARM"?n.form.taskKind="ALARM":n.form.taskKind=n.form.taskKind||"",n.form.scheduleTime=Fe(),n.mode==="create"?await E.post("/api/tasks",n.form):await E.put(`/api/tasks/${encodeURIComponent(n.taskCode)}`,n.form),T.success("保存成功"),n.visible=!1,await h()}catch(d){T.error(((r=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:r.message)||"保存失败")}finally{n.loading=!1}},Ke=async t=>{var e,a,r;try{const{data:d}=await E.post(`/api/tasks/${encodeURIComponent(t.taskCode)}/run`);T.success(((e=d==null?void 0:d.data)==null?void 0:e.summary)||"已执行"),await h()}catch(d){T.error(((r=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:r.message)||"执行失败")}},He=async t=>{var e,a;if(t!=null&&t.taskCode){try{await be.confirm(`确认删除任务 ${t.taskCode}？`,"删除确认",{type:"warning"})}catch{return}try{await E.delete(`/api/tasks/${encodeURIComponent(t.taskCode)}`),T.success("已删除"),V.value.delete(t.taskCode),await h(),W(te)}catch(r){T.error(((a=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:a.message)||"删除失败")}}},qe=async()=>{var e,a;const t=Array.from(V.value);if(t.length!==0){try{await be.confirm(`确认删除选中的 ${t.length} 个任务？`,"删除确认",{type:"warning"})}catch{return}try{await E.post("/api/tasks/batch-delete",{taskCodes:t}),T.success("已删除"),V.value=new Set,await h(),W(te)}catch(r){T.error(((a=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:a.message)||"删除失败")}}},Je=async t=>{const e=(t==null?void 0:t.taskType)||I.fixedType||"";if(e==="SCAN"){re.push({path:"/scan/history",query:{taskCode:t.taskCode}});return}if(e==="ASSESS"){re.push({path:"/assess/history",query:{taskCode:t.taskCode}});return}const{data:a}=await E.get(`/api/tasks/${encodeURIComponent(t.taskCode)}/history`);F.rows=(a==null?void 0:a.data)||[],F.visible=!0},Ye=t=>t==="SUCCESS"?"success":t==="FAILED"?"danger":t==="RUNNING"?"warning":"info",We=t=>{const e=String(t||"").toUpperCase();return e==="ONCE"?"一次性":e==="DAILY"?"每日":e==="WEEKLY"?"每周":e==="MONTHLY"?"每月":t||"未知"},Xe=t=>{const e=G.value.find(a=>a.itemCode===t);return(e==null?void 0:e.itemName)||t||"未知"},Be=J(()=>Array.from(U.value).length),Ge=async()=>{p.assetType="",p.importance="",p.keyword="",p.page=1,U.value=new Set(N.assetCodes||[]),p.visible=!0,await ee(!0)},je=()=>{ee(!1)},Qe=t=>{const e=new Set(L.value.map(r=>r.assetCode)),a=new Set(U.value);for(const r of e)a.delete(r);for(const r of t||[])r!=null&&r.assetCode&&a.add(r.assetCode);U.value=a},Ze=()=>{const t=fe.value;if(t)try{t.clearSelection();for(const e of L.value)U.value.has(e.assetCode)&&t.toggleRowSelection(e,!0)}catch{}};dt(()=>[p.visible,p.keyword,p.assetType,p.importance],async([t],[e]=[])=>{t&&e&&await ee(!0)});const et=()=>{N.assetCodes=Array.from(U.value),p.visible=!1};return M(h),M(async()=>{try{G.value=await X("TASK_STATUS")}catch{G.value=[{itemCode:"RUNNING",itemName:"运行中"},{itemCode:"SUCCESS",itemName:"成功"},{itemCode:"FAILED",itemName:"失败"}]}}),M(async()=>{try{Q.value=await X("CLAIM_DISCOVERED_TYPE")}catch{Q.value=[{itemCode:"PORT",itemName:"端口扫描"},{itemCode:"DNS",itemName:"DNS爆破"},{itemCode:"CRT",itemName:"CT查询"},{itemCode:"FOFA",itemName:"网络空间搜索"}]}}),M(async()=>{try{const{data:t}=await E.get("/api/assess/config/rules");Z.value=(t==null?void 0:t.data)||[]}catch{Z.value=[{ruleCode:"HIGH_RISK_PORT_OPEN",ruleName:"高危端口暴露"},{ruleCode:"ADMIN_PATH_EXPOSED",ruleName:"管理路径暴露"},{ruleCode:"SENSITIVE_PATH_EXPOSED",ruleName:"敏感路径暴露"},{ruleCode:"FRAMEWORK_FINGERPRINT_EXPOSED",ruleName:"框架指纹暴露"}]}}),M(async()=>{try{$.value=await X("ASSET_TYPE")}catch{$.value=[{itemCode:"WEB_APP",itemName:"Web 应用"},{itemCode:"API",itemName:"API 接口"},{itemCode:"DOMAIN",itemName:"域名"},{itemCode:"IP",itemName:"IP"},{itemCode:"DB",itemName:"数据库"},{itemCode:"OTHER",itemName:"其他"}]}try{j.value=await X("ASSET_IMPORTANCE")}catch{j.value=[{itemCode:"核心业务",itemName:"核心业务"},{itemCode:"重要业务",itemName:"重要业务"},{itemCode:"一般业务",itemName:"一般业务"},{itemCode:"辅助业务",itemName:"辅助业务"}]}}),(t,e)=>{const a=f("el-option"),r=f("el-select"),d=f("el-input"),S=f("el-button"),k=f("el-table-column"),_=f("el-tag"),se=f("el-table"),Se=f("el-pagination"),w=f("el-form-item"),tt=f("el-switch"),K=f("el-input-number"),lt=f("el-divider"),H=f("el-checkbox"),st=f("el-checkbox-group"),ve=f("el-step"),at=f("el-steps"),q=f("el-card"),ae=f("el-col"),ot=f("el-row"),Ce=f("el-collapse-item"),ge=f("el-collapse"),nt=f("el-form"),oe=f("el-dialog");return c(),D(ie,null,[u("div",mt,[u("div",pt,[l(r,{modelValue:b.taskType,"onUpdate:modelValue":e[0]||(e[0]=s=>b.taskType=s),placeholder:"任务模块",clearable:"",style:{width:"170px"},disabled:!!B.value},{default:o(()=>[l(a,{label:"扫描任务",value:"SCAN"}),l(a,{label:"评估任务",value:"ASSESS"}),l(a,{label:"告警任务",value:"ALARM"})]),_:1},8,["modelValue","disabled"]),l(r,{modelValue:b.enabled,"onUpdate:modelValue":e[1]||(e[1]=s=>b.enabled=s),placeholder:"启用状态",clearable:"",style:{width:"170px"}},{default:o(()=>[l(a,{label:"启用",value:1}),l(a,{label:"停用",value:0})]),_:1},8,["modelValue"]),l(d,{modelValue:b.keyword,"onUpdate:modelValue":e[2]||(e[2]=s=>b.keyword=s),placeholder:"任务名称关键词",style:{width:"240px"},clearable:"",onKeyup:ut(ce,["enter"])},null,8,["modelValue"]),l(S,{onClick:ce},{default:o(()=>[...e[39]||(e[39]=[m("查询",-1)])]),_:1}),l(S,{type:"danger",plain:"",disabled:we.value===0,onClick:qe},{default:o(()=>[...e[40]||(e[40]=[m("批量删除",-1)])]),_:1},8,["disabled"]),e[42]||(e[42]=u("div",{class:"spacer"},null,-1)),l(S,{type:"primary",onClick:ze},{default:o(()=>[...e[41]||(e[41]=[m("新建任务",-1)])]),_:1})]),u("div",ft,[l(se,{ref_key:"taskTableRef",ref:ue,data:z.value,height:"100%",border:"","row-key":"taskCode","reserve-selection":!0,onSelectionChange:Ve},{default:o(()=>[l(k,{type:"selection",width:"46"}),l(k,{prop:"taskCode",label:"任务编码",width:"240","show-overflow-tooltip":""}),l(k,{prop:"taskType",label:"模块",width:"90"},{default:o(({row:s})=>[l(_,{size:"small",effect:"plain"},{default:o(()=>[m(v(Oe(s)),1)]),_:2},1024)]),_:1}),l(k,{prop:"taskKind",label:"模块项",width:"220","show-overflow-tooltip":""},{default:o(({row:s})=>[l(_,{size:"small",effect:"plain"},{default:o(()=>[m(v(Pe(s)),1)]),_:2},1024)]),_:1}),l(k,{prop:"taskName",label:"名称","min-width":"220","show-overflow-tooltip":""}),l(k,{prop:"enabled",label:"启用",width:"90"},{default:o(({row:s})=>[l(_,{size:"small",type:s.enabled===1?"success":"info"},{default:o(()=>[m(v(s.enabled===1?"启用":"停用"),1)]),_:2},1032,["type"])]),_:1}),l(k,{prop:"scheduleFrequency",label:"频率",width:"110"},{default:o(({row:s})=>[l(_,{size:"small",effect:"plain"},{default:o(()=>[m(v(We(s.scheduleFrequency)),1)]),_:2},1024)]),_:1}),l(k,{prop:"scheduleTime",label:"时间",width:"120"},{default:o(({row:s})=>[u("span",null,v(ke(s.scheduleFrequency,s.scheduleTime)),1)]),_:1}),l(k,{prop:"nextRunAt",label:"下次执行",width:"170"}),l(k,{prop:"lastStatus",label:"上次状态",width:"120"},{default:o(({row:s})=>[s.lastStatus?(c(),g(_,{key:0,size:"small",type:Ye(s.lastStatus)},{default:o(()=>[m(v(Xe(s.lastStatus)),1)]),_:2},1032,["type"])):A("",!0)]),_:1}),l(k,{prop:"lastSummary",label:"上次摘要","min-width":"240","show-overflow-tooltip":""}),l(k,{label:"操作",width:"260",fixed:"right"},{default:o(({row:s})=>[l(S,{size:"small",onClick:ne=>$e(s)},{default:o(()=>[...e[43]||(e[43]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(S,{size:"small",type:"primary",plain:"",onClick:ne=>Ke(s)},{default:o(()=>[...e[44]||(e[44]=[m("执行",-1)])]),_:1},8,["onClick"]),l(S,{size:"small",onClick:ne=>Je(s)},{default:o(()=>[...e[45]||(e[45]=[m("历史",-1)])]),_:1},8,["onClick"]),l(S,{size:"small",type:"danger",plain:"",onClick:ne=>He(s)},{default:o(()=>[...e[46]||(e[46]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),u("div",ct,[l(Se,{class:"en-pagination",layout:"total, sizes, prev, pager, next",total:de.value,"page-sizes":[20,50,100],"page-size":x.size,"current-page":x.current,"onUpdate:currentPage":e[3]||(e[3]=s=>x.current=s),onSizeChange:Ee,onCurrentChange:xe},null,8,["total","page-size","current-page"])])]),l(oe,{modelValue:n.visible,"onUpdate:modelValue":e[31]||(e[31]=s=>n.visible=s),title:n.mode==="create"?"新建任务":"编辑任务",width:"820px",class:"en-task-dialog"},{footer:o(()=>[l(S,{onClick:e[30]||(e[30]=s=>n.visible=!1)},{default:o(()=>[...e[73]||(e[73]=[m("取消",-1)])]),_:1}),l(S,{type:"primary",loading:n.loading,onClick:Le},{default:o(()=>[...e[74]||(e[74]=[m("保存",-1)])]),_:1},8,["loading"])]),default:o(()=>[l(nt,{ref_key:"formRef",ref:me,model:n.form,rules:_e,"label-width":"96px"},{default:o(()=>[n.mode==="create"&&!B.value?(c(),g(w,{key:0,label:"任务模块"},{default:o(()=>[l(r,{modelValue:n.form.taskType,"onUpdate:modelValue":e[4]||(e[4]=s=>n.form.taskType=s),style:{width:"100%"},disabled:!!B.value,onChange:Ue},{default:o(()=>[l(a,{label:"扫描任务",value:"SCAN"}),l(a,{label:"评估任务",value:"ASSESS"}),l(a,{label:"告警任务",value:"ALARM"})]),_:1},8,["modelValue","disabled"])]),_:1})):A("",!0),l(w,{label:"任务名称",prop:"taskName",required:""},{default:o(()=>[l(d,{modelValue:n.form.taskName,"onUpdate:modelValue":e[5]||(e[5]=s=>n.form.taskName=s),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),l(w,{label:"启用状态"},{default:o(()=>[l(tt,{modelValue:n.form.enabled,"onUpdate:modelValue":e[6]||(e[6]=s=>n.form.enabled=s),"active-value":1,"inactive-value":0},null,8,["modelValue"]),e[47]||(e[47]=u("div",{class:"en-muted",style:{"font-size":"12px","margin-left":"10px"}}," 默认不启用：停用时不会自动定时执行，可在任务列表点击“执行”手动触发；启用后按频率自动执行。 ",-1))]),_:1}),l(w,{label:"执行频率",prop:"scheduleFrequency",required:""},{default:o(()=>[l(r,{modelValue:n.form.scheduleFrequency,"onUpdate:modelValue":e[7]||(e[7]=s=>n.form.scheduleFrequency=s),style:{width:"100%"}},{default:o(()=>[l(a,{label:"一次性",value:"ONCE"}),l(a,{label:"每日",value:"DAILY"}),l(a,{label:"每周",value:"WEEKLY"}),l(a,{label:"每月",value:"MONTHLY"})]),_:1},8,["modelValue"])]),_:1}),l(w,{label:"执行时间",required:""},{default:o(()=>[u("div",yt,[n.form.scheduleFrequency==="WEEKLY"?(c(),g(r,{key:0,modelValue:y.weeklyDow,"onUpdate:modelValue":e[8]||(e[8]=s=>y.weeklyDow=s),style:{width:"140px"}},{default:o(()=>[l(a,{label:"周一",value:"MON"}),l(a,{label:"周二",value:"TUE"}),l(a,{label:"周三",value:"WED"}),l(a,{label:"周四",value:"THU"}),l(a,{label:"周五",value:"FRI"}),l(a,{label:"周六",value:"SAT"}),l(a,{label:"周日",value:"SUN"})]),_:1},8,["modelValue"])):A("",!0),n.form.scheduleFrequency==="MONTHLY"?(c(),g(K,{key:1,modelValue:y.monthlyDom,"onUpdate:modelValue":e[9]||(e[9]=s=>y.monthlyDom=s),min:1,max:31,"controls-position":"right",style:{width:"140px"}},null,8,["modelValue"])):A("",!0),l(d,{modelValue:y.time,"onUpdate:modelValue":e[10]||(e[10]=s=>y.time=s),placeholder:"HH:mm",style:{width:"140px"}},null,8,["modelValue"]),u("div",kt,v(Me.value),1)])]),_:1}),l(lt,{"content-position":"left"},{default:o(()=>[...e[48]||(e[48]=[m("参数",-1)])]),_:1}),n.form.taskType==="SCAN"?(c(),g(w,{key:1,label:"扫描模块",required:""},{default:o(()=>[u("div",St,[l(_,{size:"small",effect:"plain"},{default:o(()=>[m(v(R(i.kind)||"请选择"),1)]),_:1})])]),_:1})):A("",!0),n.form.taskType==="ASSESS"?(c(),g(w,{key:2,label:"评估模块",required:""},{default:o(()=>[u("div",vt,[u("div",Ct,[l(st,{modelValue:N.ruleCodes,"onUpdate:modelValue":e[11]||(e[11]=s=>N.ruleCodes=s),class:"en-assess-rule-group"},{default:o(()=>[l(H,{label:"HIGH_RISK_PORT_OPEN",style:{"white-space":"nowrap"}},{default:o(()=>[...e[49]||(e[49]=[m("高危端口",-1)])]),_:1}),l(H,{label:"ADMIN_PATH_EXPOSED",style:{"white-space":"nowrap"}},{default:o(()=>[...e[50]||(e[50]=[m("管理路径",-1)])]),_:1}),l(H,{label:"SENSITIVE_PATH_EXPOSED",style:{"white-space":"nowrap"}},{default:o(()=>[...e[51]||(e[51]=[m("敏感路径",-1)])]),_:1}),l(H,{label:"FRAMEWORK_FINGERPRINT_EXPOSED",style:{"white-space":"nowrap"}},{default:o(()=>[...e[52]||(e[52]=[m("框架指纹",-1)])]),_:1})]),_:1},8,["modelValue"]),e[53]||(e[53]=u("span",{class:"en-muted en-assess-hint"},"可多选",-1))])])]),_:1})):A("",!0),n.form.taskType==="SCAN"?(c(),g(w,{key:3,label:"参数设置"},{default:o(()=>[u("div",gt,[l(at,{active:O.value-1,"finish-status":"success"},{default:o(()=>[l(ve,{title:"选择模块"}),l(ve,{title:"配置参数"})]),_:1},8,["active"]),O.value===1?(c(),D("div",Tt,[u("div",bt,[l(q,{shadow:"never",class:Y(i.kind==="PORT"?"en-choice is-active":"en-choice"),onClick:e[12]||(e[12]=s=>i.kind="PORT")},{default:o(()=>[u("div",Nt,[e[54]||(e[54]=u("span",{class:"en-choice-dot en-dot-port"},null,-1)),m(" "+v(R("PORT")||"端口扫描"),1)]),e[55]||(e[55]=u("div",{class:"en-choice-desc"},"输入 IPv4，探测开放端口",-1))]),_:1},8,["class"]),l(q,{shadow:"never",class:Y(i.kind==="DNS"?"en-choice is-active":"en-choice"),onClick:e[13]||(e[13]=s=>i.kind="DNS")},{default:o(()=>[u("div",wt,[e[56]||(e[56]=u("span",{class:"en-choice-dot en-dot-dns"},null,-1)),m(" "+v(R("DNS")||"DNS爆破"),1)]),e[57]||(e[57]=u("div",{class:"en-choice-desc"},"基于子域名字典进行发现",-1))]),_:1},8,["class"]),l(q,{shadow:"never",class:Y(i.kind==="CRT"?"en-choice is-active":"en-choice"),onClick:e[14]||(e[14]=s=>i.kind="CRT")},{default:o(()=>[u("div",At,[e[58]||(e[58]=u("span",{class:"en-choice-dot en-dot-crt"},null,-1)),m(" "+v(R("CRT")||"CT查询"),1)]),e[59]||(e[59]=u("div",{class:"en-choice-desc"},"crt.sh 查询域名相关子域名",-1))]),_:1},8,["class"]),l(q,{shadow:"never",class:Y(i.kind==="FOFA"?"en-choice is-active":"en-choice"),onClick:e[15]||(e[15]=s=>i.kind="FOFA")},{default:o(()=>[u("div",_t,[e[60]||(e[60]=u("span",{class:"en-choice-dot en-dot-fofa"},null,-1)),m(" "+v(R("FOFA")||"网络空间搜索"),1)]),e[61]||(e[61]=u("div",{class:"en-choice-desc"},"FOFA 查询（需在扫描配置中启用）",-1))]),_:1},8,["class"])]),u("div",Et,[l(S,{type:"primary",onClick:e[16]||(e[16]=s=>O.value=2)},{default:o(()=>[...e[62]||(e[62]=[m("下一步",-1)])]),_:1})])])):(c(),D("div",xt,[u("div",Vt,[l(_,{size:"small",effect:"plain"},{default:o(()=>[m("扫描模块："+v(R(i.kind)||i.kind||"-"),1)]),_:1}),l(S,{size:"small",type:"primary",onClick:e[17]||(e[17]=s=>O.value=1)},{default:o(()=>[...e[63]||(e[63]=[m("返回选择",-1)])]),_:1})]),l(ot,{gutter:8,style:{"margin-top":"8px"}},{default:o(()=>[i.kind==="PORT"?(c(),g(ae,{key:0,span:24},{default:o(()=>[l(d,{modelValue:i.ip,"onUpdate:modelValue":e[18]||(e[18]=s=>i.ip=s),placeholder:"IPv4，例如 1.1.1.1"},null,8,["modelValue"])]),_:1})):i.kind==="DNS"||i.kind==="CRT"?(c(),g(ae,{key:1,span:24},{default:o(()=>[l(d,{modelValue:i.domain,"onUpdate:modelValue":e[19]||(e[19]=s=>i.domain=s),placeholder:"域名，例如 example.com"},null,8,["modelValue"])]),_:1})):(c(),g(ae,{key:2,span:24},{default:o(()=>[l(d,{modelValue:i.query,"onUpdate:modelValue":e[20]||(e[20]=s=>i.query=s),placeholder:"FOFA 查询语法，例如 domain=example.com"},null,8,["modelValue"])]),_:1}))]),_:1}),i.kind==="PORT"?(c(),D("div",Ot,[l(r,{modelValue:i.range,"onUpdate:modelValue":e[21]||(e[21]=s=>i.range=s),style:{width:"170px"}},{default:o(()=>[l(a,{label:"全端口",value:"ALL"}),l(a,{label:"常用端口(字典)",value:"COMMON"}),l(a,{label:"自定义端口",value:"CUSTOM"})]),_:1},8,["modelValue"]),i.range==="CUSTOM"?(c(),g(d,{key:0,modelValue:i.portsText,"onUpdate:modelValue":e[22]||(e[22]=s=>i.portsText=s),placeholder:"例如 22-25,80,443"},null,8,["modelValue"])):A("",!0)])):A("",!0),i.kind==="PORT"?(c(),D("div",ht,[l(K,{modelValue:i.timeoutSec,"onUpdate:modelValue":e[23]||(e[23]=s=>i.timeoutSec=s),min:1,max:60,"controls-position":"right"},null,8,["modelValue"]),e[64]||(e[64]=u("span",{class:"en-task-mono"},"超时(s)",-1)),e[65]||(e[65]=u("span",{class:"en-task-k"},"timeoutSec",-1)),l(K,{modelValue:i.concurrency,"onUpdate:modelValue":e[24]||(e[24]=s=>i.concurrency=s),min:1,max:800,"controls-position":"right"},null,8,["modelValue"]),e[66]||(e[66]=u("span",{class:"en-task-mono"},"并发数",-1)),e[67]||(e[67]=u("span",{class:"en-task-k"},"concurrency",-1))])):A("",!0),i.kind==="FOFA"?(c(),D("div",Rt,[l(K,{modelValue:i.maxSize,"onUpdate:modelValue":e[25]||(e[25]=s=>i.maxSize=s),min:1,max:9999,"controls-position":"right"},null,8,["modelValue"]),e[68]||(e[68]=u("span",{class:"en-task-mono"},"最大数量",-1)),e[69]||(e[69]=u("span",{class:"en-task-k"},"maxSize",-1))])):A("",!0),l(ge,{style:{"margin-top":"10px"}},{default:o(()=>[l(Ce,{title:"高级：直接编辑 JSON"},{default:o(()=>[l(d,{modelValue:n.form.paramsJson,"onUpdate:modelValue":e[26]||(e[26]=s=>n.form.paramsJson=s),type:"textarea",rows:6,placeholder:"高级用户可直接编辑 paramsJson"},null,8,["modelValue"])]),_:1})]),_:1})]))])]),_:1})):n.form.taskType==="ASSESS"?(c(),g(w,{key:4,label:"参数设置"},{default:o(()=>[u("div",Pt,[u("div",Dt,[l(S,{onClick:Ge},{default:o(()=>[...e[70]||(e[70]=[m("选择资产",-1)])]),_:1}),l(_,{size:"small",effect:"plain"},{default:o(()=>[m(v((N.assetCodes||[]).length)+" 已选",1)]),_:1}),l(S,{text:"",onClick:e[27]||(e[27]=s=>N.assetCodes=[])},{default:o(()=>[...e[71]||(e[71]=[m("清空",-1)])]),_:1})]),e[72]||(e[72]=u("div",{class:"en-muted",style:{"font-size":"12px","margin-top":"6px"}},"留空表示评估全部资产",-1)),l(ge,{style:{"margin-top":"10px"}},{default:o(()=>[l(Ce,{title:"高级：直接编辑 JSON"},{default:o(()=>[l(d,{modelValue:n.form.paramsJson,"onUpdate:modelValue":e[28]||(e[28]=s=>n.form.paramsJson=s),type:"textarea",rows:6,placeholder:"例如：{assetCodes:[ASSET-...]}"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1})):(c(),g(w,{key:5,label:"参数(JSON)"},{default:o(()=>[l(d,{modelValue:n.form.paramsJson,"onUpdate:modelValue":e[29]||(e[29]=s=>n.form.paramsJson=s),type:"textarea",rows:6,placeholder:"可留空"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(oe,{modelValue:F.visible,"onUpdate:modelValue":e[32]||(e[32]=s=>F.visible=s),title:"执行历史",width:"760px"},{default:o(()=>[l(se,{data:F.rows,height:"440px",border:""},{default:o(()=>[l(k,{prop:"startedAt",label:"开始",width:"170"}),l(k,{prop:"finishedAt",label:"结束",width:"170"}),l(k,{prop:"status",label:"状态",width:"110"}),l(k,{prop:"summary",label:"摘要","min-width":"240","show-overflow-tooltip":""}),l(k,{prop:"detail",label:"详情","min-width":"260","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1},8,["modelValue"]),l(oe,{modelValue:p.visible,"onUpdate:modelValue":e[38]||(e[38]=s=>p.visible=s),title:"选择资产",width:"980px"},{footer:o(()=>[l(S,{onClick:e[37]||(e[37]=s=>p.visible=!1)},{default:o(()=>[...e[76]||(e[76]=[m("取消",-1)])]),_:1}),l(S,{type:"primary",onClick:et},{default:o(()=>[...e[77]||(e[77]=[m("确认",-1)])]),_:1})]),default:o(()=>[u("div",Ut,[l(r,{modelValue:p.assetType,"onUpdate:modelValue":e[33]||(e[33]=s=>p.assetType=s),placeholder:"资产类型",clearable:"",style:{width:"180px"}},{default:o(()=>[(c(!0),D(ie,null,Te($.value,s=>(c(),g(a,{key:s.itemCode,label:s.itemName,value:s.itemCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(r,{modelValue:p.importance,"onUpdate:modelValue":e[34]||(e[34]=s=>p.importance=s),placeholder:"业务重要性",clearable:"",style:{width:"180px"}},{default:o(()=>[(c(!0),D(ie,null,Te(j.value,s=>(c(),g(a,{key:s.itemCode,label:s.itemName,value:s.itemCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(d,{modelValue:p.keyword,"onUpdate:modelValue":e[35]||(e[35]=s=>p.keyword=s),placeholder:"搜索 名称/地址/编号",clearable:"",style:{width:"260px"}},null,8,["modelValue"]),e[75]||(e[75]=u("div",{class:"spacer"},null,-1)),l(_,{size:"small",effect:"plain"},{default:o(()=>[m(v(Be.value)+" 已选",1)]),_:1})]),u("div",It,[l(se,{ref_key:"assetTableRef",ref:fe,data:L.value,height:"100%",border:"","row-key":"assetCode","reserve-selection":!0,onSelectionChange:Qe},{default:o(()=>[l(k,{type:"selection",width:"46"}),l(k,{prop:"assetCode",label:"编号",width:"240","show-overflow-tooltip":""}),l(k,{prop:"assetName",label:"名称",width:"180","show-overflow-tooltip":""}),l(k,{prop:"assetType",label:"类型",width:"110"},{default:o(({row:s})=>[u("span",null,v(Ae(s==null?void 0:s.assetType)),1)]),_:1}),l(k,{prop:"assetAddress",label:"地址","min-width":"240","show-overflow-tooltip":""})]),_:1},8,["data"])]),u("div",Ft,[l(Se,{layout:"total, prev, pager, next",total:pe.value,"page-size":p.pageSize,"current-page":p.page,"onUpdate:currentPage":e[36]||(e[36]=s=>p.page=s),onCurrentChange:je},null,8,["total","page-size","current-page"])])]),_:1},8,["modelValue"])],64)}}},Lt=it(Mt,[["__scopeId","data-v-e980d101"]]);export{Lt as T};
